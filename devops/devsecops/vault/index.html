
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../What%20is%20Falco/">
      
      
        <link rel="next" href="../../jenkins/jenkins-installation/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Vault in Kubernetes/VM installation - Hepapi Knowledge Hub</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Montserrat";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="white">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#vault-installation-using-helm-and-running-on-kubernetes-clsuter" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Hepapi Knowledge Hub" class="md-header__button md-logo" aria-label="Hepapi Knowledge Hub" data-md-component="logo">
      
  <img src="../../../images/hepapi-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Hepapi Knowledge Hub
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Vault in Kubernetes/VM installation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="white"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="white"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/hepapi/knowledge-hub" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    hepapi/knowledge-hub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../.." class="md-tabs__link">
          
  
  
  DevOps

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../qa/" class="md-tabs__link">
          
  
  
  QA

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../misc/how-to-contribute/mkdocs-features/" class="md-tabs__link">
          
  
  
  Misc

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../repo-credit/" class="md-tabs__link">
        
  
  
    
  
  Credits

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Hepapi Knowledge Hub" class="md-nav__button md-logo" aria-label="Hepapi Knowledge Hub" data-md-component="logo">
      
  <img src="../../../images/hepapi-logo.png" alt="logo">

    </a>
    Hepapi Knowledge Hub
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hepapi/knowledge-hub" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    hepapi/knowledge-hub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    DevOps
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    DevOps
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome to Hepapi Knowledge Hub
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Linux
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Linux
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2_1" >
        
          
          <label class="md-nav__link" for="__nav_1_2_1" id="__nav_1_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Shell Commands
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Shell Commands
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/shell/script/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    script
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/shell/cat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    cat
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/shell/chtsh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    cht.sh
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/shell/jobs-bg-fg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    jobs, bg, fg
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/shell/ampersand-nohup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    nohup, &
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/shell/nslookup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    nslookup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/shell/nmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    nmap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/shell/netstat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    netstat, ss, ps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/shell/scp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    scp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/tooling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tooling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/tips/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tips
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    AWS
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    AWS
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AWS CLIv2 Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/sso/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AWS IAM Identity Center (successor to AWS Single Sign-On), What is SSO?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" >
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Azure
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Azure
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../azure/agent-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_5" >
        
          
          <label class="md-nav__link" for="__nav_1_5" id="__nav_1_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Kubernetes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/keda/keda/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    keda(k8s event-driven Autoscaling)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-engine/k3s-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    K3S Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/Velero/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cluster Backup with Velero
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/keda/keda-with-cron/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    KEDA (Kubernetes Event-driven Autoscaling) WITH CRON
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_6" >
        
          
          <label class="md-nav__link" for="__nav_1_6" id="__nav_1_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    RKE2
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    RKE2
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-engine/rke2-installation-ansible/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RKE2 Ansible Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-engine/rke2-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RKE2 Binary Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_6_3" >
        
          
          <label class="md-nav__link" for="__nav_1_6_3" id="__nav_1_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    RKE2 HA (Highly Available)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_6_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    RKE2 HA (Highly Available)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-engine/rke2-ha/rke2-highly-available-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HA Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-engine/rke2-ha/rke2-system-upgrade-controller-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Automatic Upgrades(rancher/system-upgrade-controller)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-engine/rke2-ha/rke2-ha-etcd-restore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How to ETCD Restore
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_7" >
        
          
          <label class="md-nav__link" for="__nav_1_7" id="__nav_1_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Docker
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/portainer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker Management with Portainer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_8" >
        
          
          <label class="md-nav__link" for="__nav_1_8" id="__nav_1_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Rancher
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Rancher
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rancher/rancher-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rancher Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_9" >
        
          
          <label class="md-nav__link" for="__nav_1_9" id="__nav_1_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Postgres
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Postgres
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../postgres/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../postgres/psql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    psql
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../postgres/backup-restore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backup & Restore
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_10" >
        
          
          <label class="md-nav__link" for="__nav_1_10" id="__nav_1_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Nexus
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Nexus
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nexus/nexus-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nexus Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nexus/nexus-user-and-roles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    User And Roles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nexus/docker-hosted-repo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker Hosted Repository
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nexus/docker-proxy-repo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker Proxy Repository
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nexus/pull-to-kubernetes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pull Images to Kubernetes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nexus/registry-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RKE2 Registry Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_11" checked>
        
          
          <label class="md-nav__link" for="__nav_1_11" id="__nav_1_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    DevSecOps
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_11_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    DevSecOps
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DevSecOps-SonarQube-OWASP-Conftest-Trvy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DevSecOps with SonarQube, OWASP Dependency-Check, Conftest and Trivy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../external-secret-operator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    External Secret Operator via Minikube and AWS Secret Manager
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../What%20is%20Falco/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    What is Falco?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Vault in Kubernetes/VM installation
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Vault in Kubernetes/VM installation
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vault-installation-using-helm-and-running-on-kubernetes-clsuter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vault Installation - Using Helm and running on Kubernetes Clsuter
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vault Installation - Using Helm and running on Kubernetes Clsuter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-helm-repository" class="md-nav__link">
    <span class="md-ellipsis">
      
        Add Helm Repository
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-namespace" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Namespace
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-using-helm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install (Using Helm)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-vault-1-and-vault-2-node-to-vault-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        Join vault-1 and vault-2 node to Vault cluster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vault-installation-install-as-systemd-service" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vault Installation - install as systemd service
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vault Installation - install as systemd service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-node-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Single-Node Deployment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#high-availability-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        High Availability Cluster
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="High Availability Cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-on-node-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Run on NODE-1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-on-node-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Run on NODE-2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-on-node-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Run on NODE-3
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#auto-unseal" class="md-nav__link">
    <span class="md-ellipsis">
      
        auto-unseal
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="auto-unseal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-k8s-deploymnet" class="md-nav__link">
    <span class="md-ellipsis">
      
        for k8s deploymnet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-systemd-service" class="md-nav__link">
    <span class="md-ellipsis">
      
        for systemd service
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-tls-for-systemd-service" class="md-nav__link">
    <span class="md-ellipsis">
      
        use tls (for systemd service)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ldap-integration-for-systemd-service" class="md-nav__link">
    <span class="md-ellipsis">
      
        LDAP integration (for systemd service)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#auth-kubernetes-enable" class="md-nav__link">
    <span class="md-ellipsis">
      
        auth-kubernetes enable
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="auth-kubernetes enable">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kubernetes-side-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kubernetes side configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Kubernetes side configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-create-service-account-and-rbac" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Create Service Account and RBAC
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-service-account-token" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Create Service Account Token
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vault-server-side-configuration-only-using-by-single-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vault server side configuration (only using by single cluster)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vault server side configuration (only using by single cluster)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-3-enable-kubernetes-auth-method" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Enable Kubernetes Auth Method
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-configure-kubernetes-auth" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Configure Kubernetes Auth
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-create-vault-policy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Create Vault Policy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-create-kubernetes-role" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6: Create Kubernetes Role
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-7-test-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 7: Test Authentication
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-clusters-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multiple Clusters Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multiple Clusters Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster-1-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cluster 1 Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cluster 1 Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-enable-kubernetes-auth-for-cluster-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Enable Kubernetes Auth for Cluster 1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-policy-for-cluster-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Create Policy for Cluster 1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-configure-kubernetes-auth-for-cluster-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Configure Kubernetes Auth for Cluster 1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-create-role-for-cluster-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Create Role for Cluster 1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-test-authentication-for-cluster-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Test Authentication for Cluster 1
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster-2-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cluster 2 Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cluster 2 Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-enable-kubernetes-auth-for-cluster-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Enable Kubernetes Auth for Cluster 2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-policy-for-cluster-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Create Policy for Cluster 2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-configure-kubernetes-auth-for-cluster-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Configure Kubernetes Auth for Cluster 2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-create-role-for-cluster-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Create Role for Cluster 2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-test-authentication-for-cluster-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Test Authentication for Cluster 2
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verification-commands-for-multiple-clusters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verification Commands for Multiple Clusters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustersecretstore-configuration-for-each-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        ClusterSecretStore Configuration for Each Cluster
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ClusterSecretStore Configuration for Each Cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster-1-clustersecretstore" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cluster 1 ClusterSecretStore
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster-2-clustersecretstore" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cluster 2 ClusterSecretStore
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secret-engines-for-each-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        Secret Engines for Each Cluster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-side-create-clustersecretstore" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kubernetes side - Create ClusterSecretStore
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Kubernetes side - Create ClusterSecretStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-8-create-clustersecretstore" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 8: Create ClusterSecretStore
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-the-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing the Integration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing the Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-9-create-test-secret-in-vault" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 9: Create Test Secret in Vault
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-10-create-externalsecret-for-testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 10: Create ExternalSecret for Testing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-11-verify-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 11: Verify Integration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-secret-engine" class="md-nav__link">
    <span class="md-ellipsis">
      
        database secret engine
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="database secret engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-postgres-pod" class="md-nav__link">
    <span class="md-ellipsis">
      
        running postgres pod
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-secret-engine" class="md-nav__link">
    <span class="md-ellipsis">
      
        enable secret engine
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-policy-for-database-role" class="md-nav__link">
    <span class="md-ellipsis">
      
        define policy for database role
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#regenerate-new-root-token" class="md-nav__link">
    <span class="md-ellipsis">
      
        regenerate new root-token
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vault-policy-group-and-user-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vault Policy, Group, and User Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vault Policy, Group, and User Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#methods-to-create-policies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Methods to Create Policies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-creation-and-policy-assignment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Group Creation and Policy Assignment
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-project-team-group-and-assign-policy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create project-team group and assign policy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create project-team group and assign policy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-creation-and-group-assignment" class="md-nav__link">
    <span class="md-ellipsis">
      
        User Creation and Group Assignment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vault-secret-creation-and-referencing-in-deployments" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vault Secret Creation and Referencing in Deployments
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vault Secret Creation and Referencing in Deployments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#referencing-secrets-in-deployment-configuration-valuesyaml" class="md-nav__link">
    <span class="md-ellipsis">
      
        Referencing Secrets in Deployment Configuration (values.yaml)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-a-clustersecretstore-for-a-new-secret-engine" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating a ClusterSecretStore for a New Secret Engine
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-1-cloning-an-existing-clustersecretstore" class="md-nav__link">
    <span class="md-ellipsis">
      
        Method 1: Cloning an Existing ClusterSecretStore
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-2-applying-a-new-clustersecretstore-crd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Method 2: Applying a New ClusterSecretStore CRD
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_12" >
        
          
          <label class="md-nav__link" for="__nav_1_12" id="__nav_1_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Jenkins
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Jenkins
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../jenkins/jenkins-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Jenkins Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../jenkins/shared-library/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Jenkins Shared Library
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_13" >
        
          
          <label class="md-nav__link" for="__nav_1_13" id="__nav_1_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Terraform
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    Terraform
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Terragrunt/README.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    What is Terragrunt?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_14" >
        
          
          <label class="md-nav__link" for="__nav_1_14" id="__nav_1_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Ansible
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    Ansible
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ansible/ansible-installations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ansible Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ansible/what-is-ansible/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About Ansible
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ansible/inventory-file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Inventory File
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ansible/config-file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration File
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ansible/playbook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Playbooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ansible/ansible-roles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Roles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_15" >
        
          
          <label class="md-nav__link" for="__nav_1_15" id="__nav_1_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Monitoring
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    Monitoring
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../monitoring/Rke2-cert-expiration/Rke2-cert-monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RKE2 Cluster-cert-expiration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_16" >
        
          
          <label class="md-nav__link" for="__nav_1_16" id="__nav_1_16_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Logging
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_16">
            <span class="md-nav__icon md-icon"></span>
            
  
    Logging
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logging/ELK-stack-with-FileBeat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ELK Stack
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logging/Index-Lifecycle-Management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ELK Index Lifecycle Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logging/elasticsearch-exporter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Elasticsearch-Exporter for Prometheus-Grafana
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logging/loki-single-binary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Grafana Loki With Single Binary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logging/loki-distributed/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Grafana Loki: Distributed Log Management and Collection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logging/efk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EFK (EFK Stack (Elasticsearch, Fluentbit, Kibana)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logging/elastalert2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Elastalert2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logging/elk-snapshot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Elasticsearch Snapshot
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_17" >
        
          
          <label class="md-nav__link" for="__nav_1_17" id="__nav_1_17_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    SRE
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_17">
            <span class="md-nav__icon md-icon"></span>
            
  
    SRE
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sre/k8sgpt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    K8SGPT
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_18" >
        
          
          <label class="md-nav__link" for="__nav_1_18" id="__nav_1_18_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Git
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_18">
            <span class="md-nav__icon md-icon"></span>
            
  
    Git
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../git/Description/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Description
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../git/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../git/Commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_19" >
        
          
          <label class="md-nav__link" for="__nav_1_19" id="__nav_1_19_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Gitlab
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_19">
            <span class="md-nav__icon md-icon"></span>
            
  
    Gitlab
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gitlab/gitlab-self-hosted-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gitlab Self Hosted Kubernetes Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gitlab/gitlab-runner-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gitlab Runner Kubernetes Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_20" >
        
          
          <label class="md-nav__link" for="__nav_1_20" id="__nav_1_20_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Falcon LogScale
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_20_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_20">
            <span class="md-nav__icon md-icon"></span>
            
  
    Falcon LogScale
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_20_1" >
        
          
          <label class="md-nav__link" for="__nav_1_20_1" id="__nav_1_20_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Installation With Docker
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_20_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_20_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Installation With Docker
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../falcon-logscale/falcon-logscale-installation-docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker Container Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../falcon-logscale/agent-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent Installation (Log Collector)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_20_2" >
        
          
          <label class="md-nav__link" for="__nav_1_20_2" id="__nav_1_20_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Single Node Installation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_20_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_20_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Single Node Installation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../falcon-logscale/humiosetup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Falcon LogScale Installation Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../falcon-logscale/javainstallation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Java Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../falcon-logscale/zookeeperinstallation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Zookeeper Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../falcon-logscale/kafkainstallation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kafka Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../falcon-logscale/humioinstallation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LogScale Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_20_3" >
        
          
          <label class="md-nav__link" for="__nav_1_20_3" id="__nav_1_20_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cluster Node Installation (bash)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_20_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_20_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cluster Node Installation (bash)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../falcon-logscale/kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kafka Install
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../falcon-logscale/humio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Humio Install
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../falcon-logscale/readme/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Readme
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_21" >
        
          
          <label class="md-nav__link" for="__nav_1_21" id="__nav_1_21_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Sumo Logic
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_21_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_21">
            <span class="md-nav__icon md-icon"></span>
            
  
    Sumo Logic
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sumo/sumo-linux-collector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Install a Collector on Linux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sumo/sumo-windows-collector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Install a Collector on Windows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sumo/sumo-local-file-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Local Configuration File Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_22" >
        
          
          <label class="md-nav__link" for="__nav_1_22" id="__nav_1_22_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Vagrant
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_22_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_22">
            <span class="md-nav__icon md-icon"></span>
            
  
    Vagrant
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vagrant/vagrant-quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vagrant Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_23" >
        
          
          <label class="md-nav__link" for="__nav_1_23" id="__nav_1_23_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Sealed-Secrets
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_23_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_23">
            <span class="md-nav__icon md-icon"></span>
            
  
    Sealed-Secrets
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sealed-secrets/sealed-secrets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sealed-Secrets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_24" >
        
          
          <label class="md-nav__link" for="__nav_1_24" id="__nav_1_24_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Service-Mesh
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_24_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_24">
            <span class="md-nav__icon md-icon"></span>
            
  
    Service-Mesh
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service-mesh/istio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Istio
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_25" >
        
          
          <label class="md-nav__link" for="__nav_1_25" id="__nav_1_25_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Sonarqube
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_25_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_25">
            <span class="md-nav__icon md-icon"></span>
            
  
    Sonarqube
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sonarqube/advanced-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sonarqube
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_26" >
        
          
          <label class="md-nav__link" for="__nav_1_26" id="__nav_1_26_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    K8S Storage
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_26_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_26">
            <span class="md-nav__icon md-icon"></span>
            
  
    K8S Storage
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-storage/nfs-install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NFS(Network File System)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-storage/longhorn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Longhorn Block Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s-storage/rook-ceph/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rook-Ceph Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_27" >
        
          
          <label class="md-nav__link" for="__nav_1_27" id="__nav_1_27_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    OpenTelemtry
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_27_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_27">
            <span class="md-nav__icon md-icon"></span>
            
  
    OpenTelemtry
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../opentelemetry/auto-vs-manuel-inject/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Auto-vs-Manuel-Injection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    QA
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    QA
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../qa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome to Hepapi QA Knowledge Hub
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../qa/Fundamentals_of_QA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fundamentals of QA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../qa/test_approaches_in_quality_assurance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test Approaches in QA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../qa/types_of_tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Type of Test
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../qa/QA_Testing_Process/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fundamentals of QA Test Processes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../qa/QA_Bug_Reporting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    QA Bug Reporting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../qa/Software_Testing_Tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Software Testing Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../qa/automation_testing_and_best_practices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Automation Testing and Best Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../qa/test_processes_and_qa_practices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test Processes and QA Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../qa/SSH_Config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SSH Config
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Misc
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Misc
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    How to Contribute
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    How to Contribute
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../misc/how-to-contribute/mkdocs-features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mkdocs & Material Theme Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../misc/how-to-contribute/about-mkdocs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    creating new mkdocs pages
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../misc/how-to-contribute/about-markdown/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    writing markdown files
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../repo-credit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Credits
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vault-installation-using-helm-and-running-on-kubernetes-clsuter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vault Installation - Using Helm and running on Kubernetes Clsuter
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vault Installation - Using Helm and running on Kubernetes Clsuter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-helm-repository" class="md-nav__link">
    <span class="md-ellipsis">
      
        Add Helm Repository
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-namespace" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Namespace
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-using-helm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install (Using Helm)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-vault-1-and-vault-2-node-to-vault-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        Join vault-1 and vault-2 node to Vault cluster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vault-installation-install-as-systemd-service" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vault Installation - install as systemd service
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vault Installation - install as systemd service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-node-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Single-Node Deployment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#high-availability-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        High Availability Cluster
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="High Availability Cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-on-node-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Run on NODE-1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-on-node-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Run on NODE-2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-on-node-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Run on NODE-3
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#auto-unseal" class="md-nav__link">
    <span class="md-ellipsis">
      
        auto-unseal
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="auto-unseal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-k8s-deploymnet" class="md-nav__link">
    <span class="md-ellipsis">
      
        for k8s deploymnet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-systemd-service" class="md-nav__link">
    <span class="md-ellipsis">
      
        for systemd service
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-tls-for-systemd-service" class="md-nav__link">
    <span class="md-ellipsis">
      
        use tls (for systemd service)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ldap-integration-for-systemd-service" class="md-nav__link">
    <span class="md-ellipsis">
      
        LDAP integration (for systemd service)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#auth-kubernetes-enable" class="md-nav__link">
    <span class="md-ellipsis">
      
        auth-kubernetes enable
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="auth-kubernetes enable">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kubernetes-side-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kubernetes side configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Kubernetes side configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-create-service-account-and-rbac" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Create Service Account and RBAC
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-service-account-token" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Create Service Account Token
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vault-server-side-configuration-only-using-by-single-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vault server side configuration (only using by single cluster)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vault server side configuration (only using by single cluster)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-3-enable-kubernetes-auth-method" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Enable Kubernetes Auth Method
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-configure-kubernetes-auth" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Configure Kubernetes Auth
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-create-vault-policy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Create Vault Policy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-create-kubernetes-role" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6: Create Kubernetes Role
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-7-test-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 7: Test Authentication
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-clusters-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multiple Clusters Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multiple Clusters Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster-1-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cluster 1 Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cluster 1 Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-enable-kubernetes-auth-for-cluster-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Enable Kubernetes Auth for Cluster 1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-policy-for-cluster-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Create Policy for Cluster 1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-configure-kubernetes-auth-for-cluster-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Configure Kubernetes Auth for Cluster 1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-create-role-for-cluster-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Create Role for Cluster 1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-test-authentication-for-cluster-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Test Authentication for Cluster 1
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster-2-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cluster 2 Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cluster 2 Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-enable-kubernetes-auth-for-cluster-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Enable Kubernetes Auth for Cluster 2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-policy-for-cluster-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Create Policy for Cluster 2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-configure-kubernetes-auth-for-cluster-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Configure Kubernetes Auth for Cluster 2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-create-role-for-cluster-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Create Role for Cluster 2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-test-authentication-for-cluster-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Test Authentication for Cluster 2
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verification-commands-for-multiple-clusters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verification Commands for Multiple Clusters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustersecretstore-configuration-for-each-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        ClusterSecretStore Configuration for Each Cluster
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ClusterSecretStore Configuration for Each Cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster-1-clustersecretstore" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cluster 1 ClusterSecretStore
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster-2-clustersecretstore" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cluster 2 ClusterSecretStore
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secret-engines-for-each-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        Secret Engines for Each Cluster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-side-create-clustersecretstore" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kubernetes side - Create ClusterSecretStore
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Kubernetes side - Create ClusterSecretStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-8-create-clustersecretstore" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 8: Create ClusterSecretStore
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-the-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing the Integration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing the Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-9-create-test-secret-in-vault" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 9: Create Test Secret in Vault
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-10-create-externalsecret-for-testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 10: Create ExternalSecret for Testing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-11-verify-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 11: Verify Integration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-secret-engine" class="md-nav__link">
    <span class="md-ellipsis">
      
        database secret engine
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="database secret engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-postgres-pod" class="md-nav__link">
    <span class="md-ellipsis">
      
        running postgres pod
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-secret-engine" class="md-nav__link">
    <span class="md-ellipsis">
      
        enable secret engine
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-policy-for-database-role" class="md-nav__link">
    <span class="md-ellipsis">
      
        define policy for database role
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#regenerate-new-root-token" class="md-nav__link">
    <span class="md-ellipsis">
      
        regenerate new root-token
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vault-policy-group-and-user-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vault Policy, Group, and User Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vault Policy, Group, and User Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#methods-to-create-policies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Methods to Create Policies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-creation-and-policy-assignment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Group Creation and Policy Assignment
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-project-team-group-and-assign-policy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create project-team group and assign policy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create project-team group and assign policy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-creation-and-group-assignment" class="md-nav__link">
    <span class="md-ellipsis">
      
        User Creation and Group Assignment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vault-secret-creation-and-referencing-in-deployments" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vault Secret Creation and Referencing in Deployments
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vault Secret Creation and Referencing in Deployments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#referencing-secrets-in-deployment-configuration-valuesyaml" class="md-nav__link">
    <span class="md-ellipsis">
      
        Referencing Secrets in Deployment Configuration (values.yaml)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-a-clustersecretstore-for-a-new-secret-engine" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating a ClusterSecretStore for a New Secret Engine
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-1-cloning-an-existing-clustersecretstore" class="md-nav__link">
    <span class="md-ellipsis">
      
        Method 1: Cloning an Existing ClusterSecretStore
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-2-applying-a-new-clustersecretstore-crd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Method 2: Applying a New ClusterSecretStore CRD
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/hepapi/knowledge-hub/edit/main/docs/devops/devsecops/vault.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg>
    </a>
  
  


  <h1>Vault in Kubernetes/VM installation</h1>

<h2 id="vault-installation-using-helm-and-running-on-kubernetes-clsuter">Vault Installation - Using Helm and running on Kubernetes Clsuter</h2>
<ul>
<li><a href="https://artifacthub.io/packages/helm/hashicorp/vault"> Vault Helm Installation repo</a></li>
</ul>
<h3 id="add-helm-repository">Add Helm Repository</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>hashicorp<span class="w"> </span>https://helm.releases.hashicorp.com
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>helm<span class="w"> </span>repo<span class="w"> </span>update
</code></pre></div>
<h3 id="create-namespace">Create Namespace</h3>
<ul>
<li>Create the argocd namespace if it doesn't exist:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>vault
</code></pre></div>
<h3 id="install-using-helm">Install (Using Helm)</h3>
<ul>
<li>
<p>Install Vault with your custom ext-vault-values.yaml:</p>
</li>
<li>
<p>Example <code>ext-vault-values.yaml</code> </p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>vi<span class="w"> </span>ext-vault-values.yaml
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nt">global</span><span class="p">:</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="nt">injector</span><span class="p">:</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">  </span><span class="c1"># resources:</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">  </span><span class="c1">#   requests:</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">  </span><span class="c1">#     memory: 256Mi</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">  </span><span class="c1">#     cpu: 250m</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">  </span><span class="c1">#   limits:</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">  </span><span class="c1">#     memory: 256Mi</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">  </span><span class="c1">#     cpu: 250m</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">  </span><span class="nt">nodeSelector</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="nt">server</span><span class="p">:</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="w">    </span><span class="nt">annotations</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="w">    </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="w">    </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="w">    </span><span class="nt">activeService</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="w">    </span><span class="nt">hosts</span><span class="p">:</span>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chart-example.local</span>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="w">        </span><span class="nt">paths</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="w">    </span><span class="nt">tls</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a><span class="w">  </span><span class="nt">dataStorage</span><span class="p">:</span>
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a><span class="w">    </span><span class="c1"># Size of the PVC created</span>
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a><span class="w">    </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a><span class="w">    </span><span class="c1"># Location where the PVC will be mounted.</span>
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a><span class="w">    </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/vault/data&quot;</span>
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a><span class="w">    </span><span class="c1"># Name of the storage class to use.  If null it will use the</span>
<a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a><span class="w">    </span><span class="c1"># configured default Storage Class.</span>
<a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a><span class="w">    </span><span class="nt">storageClass</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a><span class="w">    </span><span class="c1"># Access Mode of the storage device being used for the PVC</span>
<a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a><span class="w">    </span><span class="nt">accessMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a><span class="w">    </span><span class="c1"># Annotations to apply to the PVC</span>
<a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a><span class="w">    </span><span class="nt">annotations</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a><span class="w">    </span><span class="c1"># Labels to apply to the PVC</span>
<a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a><span class="w">    </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a><span class="w">  </span><span class="nt">affinity</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a><span class="w">  </span><span class="nt">ha</span><span class="p">:</span>
<a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a><span class="w">    </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a><span class="w">    </span><span class="nt">raft</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a><span class="w">    </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a><span class="w">      </span><span class="no">ui = true</span>
<a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a>
<a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a><span class="w">      </span><span class="no">listener &quot;tcp&quot; {</span>
<a id="__codelineno-3-53" name="__codelineno-3-53" href="#__codelineno-3-53"></a><span class="w">        </span><span class="no">tls_disable = 1</span>
<a id="__codelineno-3-54" name="__codelineno-3-54" href="#__codelineno-3-54"></a><span class="w">        </span><span class="no">address = &quot;[::]:8200&quot;</span>
<a id="__codelineno-3-55" name="__codelineno-3-55" href="#__codelineno-3-55"></a><span class="w">        </span><span class="no">cluster_address = &quot;[::]:8201&quot;</span>
<a id="__codelineno-3-56" name="__codelineno-3-56" href="#__codelineno-3-56"></a><span class="w">      </span><span class="no">}</span>
<a id="__codelineno-3-57" name="__codelineno-3-57" href="#__codelineno-3-57"></a><span class="w">      </span><span class="no">storage &quot;raft&quot; {</span>
<a id="__codelineno-3-58" name="__codelineno-3-58" href="#__codelineno-3-58"></a><span class="w">          </span><span class="no">path = &quot;/vault/data&quot;</span>
<a id="__codelineno-3-59" name="__codelineno-3-59" href="#__codelineno-3-59"></a>
<a id="__codelineno-3-60" name="__codelineno-3-60" href="#__codelineno-3-60"></a><span class="w">          </span><span class="no">retry_join {</span>
<a id="__codelineno-3-61" name="__codelineno-3-61" href="#__codelineno-3-61"></a><span class="w">            </span><span class="no">leader_api_addr = &quot;http://vault-0.vault-internal:8200&quot;</span>
<a id="__codelineno-3-62" name="__codelineno-3-62" href="#__codelineno-3-62"></a><span class="w">          </span><span class="no">}</span>
<a id="__codelineno-3-63" name="__codelineno-3-63" href="#__codelineno-3-63"></a><span class="w">          </span><span class="no">retry_join {</span>
<a id="__codelineno-3-64" name="__codelineno-3-64" href="#__codelineno-3-64"></a><span class="w">            </span><span class="no">leader_api_addr = &quot;http://vault-1.vault-internal:8200&quot;</span>
<a id="__codelineno-3-65" name="__codelineno-3-65" href="#__codelineno-3-65"></a><span class="w">          </span><span class="no">}</span>
<a id="__codelineno-3-66" name="__codelineno-3-66" href="#__codelineno-3-66"></a><span class="w">          </span><span class="no">retry_join {</span>
<a id="__codelineno-3-67" name="__codelineno-3-67" href="#__codelineno-3-67"></a><span class="w">            </span><span class="no">leader_api_addr = &quot;http://vault-2.vault-internal:8200&quot;</span>
<a id="__codelineno-3-68" name="__codelineno-3-68" href="#__codelineno-3-68"></a><span class="w">          </span><span class="no">}</span>
<a id="__codelineno-3-69" name="__codelineno-3-69" href="#__codelineno-3-69"></a><span class="w">        </span><span class="no">}</span>
<a id="__codelineno-3-70" name="__codelineno-3-70" href="#__codelineno-3-70"></a>
<a id="__codelineno-3-71" name="__codelineno-3-71" href="#__codelineno-3-71"></a><span class="w">      </span><span class="no">service_registration &quot;kubernetes&quot; {}</span>
<a id="__codelineno-3-72" name="__codelineno-3-72" href="#__codelineno-3-72"></a><span class="nt">ui</span><span class="p">:</span>
<a id="__codelineno-3-73" name="__codelineno-3-73" href="#__codelineno-3-73"></a><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-3-74" name="__codelineno-3-74" href="#__codelineno-3-74"></a><span class="w">  </span><span class="nt">publishNotReadyAddresses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-3-75" name="__codelineno-3-75" href="#__codelineno-3-75"></a><span class="w">  </span><span class="c1"># The service should only contain selectors for active Vault pod</span>
<a id="__codelineno-3-76" name="__codelineno-3-76" href="#__codelineno-3-76"></a><span class="w">  </span><span class="nt">activeVaultPodOnly</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id="__codelineno-3-77" name="__codelineno-3-77" href="#__codelineno-3-77"></a><span class="w">  </span><span class="nt">serviceType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ClusterIP&quot;</span>
<a id="__codelineno-3-78" name="__codelineno-3-78" href="#__codelineno-3-78"></a><span class="w">  </span><span class="nt">serviceNodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<a id="__codelineno-3-79" name="__codelineno-3-79" href="#__codelineno-3-79"></a><span class="w">  </span><span class="nt">externalPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8200</span>
<a id="__codelineno-3-80" name="__codelineno-3-80" href="#__codelineno-3-80"></a><span class="w">  </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8200</span>
<a id="__codelineno-3-81" name="__codelineno-3-81" href="#__codelineno-3-81"></a><span class="nt">csi</span><span class="p">:</span>
<a id="__codelineno-3-82" name="__codelineno-3-82" href="#__codelineno-3-82"></a><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id="__codelineno-3-83" name="__codelineno-3-83" href="#__codelineno-3-83"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span>
<a id="__codelineno-3-84" name="__codelineno-3-84" href="#__codelineno-3-84"></a><span class="w">    </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;hashicorp/vault-csi-provider&quot;</span>
<a id="__codelineno-3-85" name="__codelineno-3-85" href="#__codelineno-3-85"></a><span class="w">    </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.5.0&quot;</span>
<a id="__codelineno-3-86" name="__codelineno-3-86" href="#__codelineno-3-86"></a><span class="w">    </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<a id="__codelineno-3-87" name="__codelineno-3-87" href="#__codelineno-3-87"></a><span class="nt">serverTelemetry</span><span class="p">:</span>
<a id="__codelineno-3-88" name="__codelineno-3-88" href="#__codelineno-3-88"></a><span class="w">  </span><span class="nt">serviceMonitor</span><span class="p">:</span>
<a id="__codelineno-3-89" name="__codelineno-3-89" href="#__codelineno-3-89"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id="__codelineno-3-90" name="__codelineno-3-90" href="#__codelineno-3-90"></a><span class="w">  </span><span class="nt">prometheusRules</span><span class="p">:</span>
<a id="__codelineno-3-91" name="__codelineno-3-91" href="#__codelineno-3-91"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>helm<span class="w"> </span>upgrade<span class="w"> </span>--install<span class="w"> </span>vault<span class="w"> </span>hashicorp/vault<span class="w"> </span>--version<span class="w"> </span><span class="m">0</span>.30.0<span class="w"> </span>-f<span class="w"> </span>ext-vault-values.yaml<span class="w"> </span><span class="c1">## change or remove version if need</span>
</code></pre></div>
<ul>
<li>Verify Installation</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>vault-0<span class="w"> </span>-n<span class="w"> </span>vault<span class="w"> </span>--<span class="w"> </span>vault<span class="w"> </span>status
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-ti<span class="w"> </span>vault-0<span class="w"> </span>-n<span class="w"> </span>vault<span class="w"> </span>--<span class="w"> </span>vault<span class="w"> </span>operator<span class="w"> </span>init<span class="w"> </span>-key-shares<span class="o">=</span><span class="m">3</span><span class="w"> </span>-key-threshold<span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="c1">## default  -key-shares=5 -key-threshold=3</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>vault-0<span class="w"> </span>-n<span class="w"> </span>vault<span class="w"> </span>--<span class="w"> </span>/bin/bash<span class="w"> </span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="c1">## show output like this</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>Unseal<span class="w"> </span>Key<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>&lt;unsealkey1&gt;
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>Unseal<span class="w"> </span>Key<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>&lt;unsealkey2&gt;
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>Unseal<span class="w"> </span>Key<span class="w"> </span><span class="m">3</span>:<span class="w"> </span>&lt;unsealkey3&gt;
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>Initial<span class="w"> </span>Root<span class="w"> </span>Token:<span class="w"> </span>hvs.xxxxxxxx
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="c1">## for unseal vault </span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>vault<span class="w"> </span>operator<span class="w"> </span>unseal<span class="w"> </span>&lt;unsealkey1&gt;
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>vault<span class="w"> </span>operator<span class="w"> </span>unseal<span class="w"> </span>&lt;unsealkey2&gt;
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="c1">## verify status vault and see &quot;Sealed status is false&quot;</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>vault<span class="w"> </span>status
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>Key<span class="w">                     </span>Value
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>---<span class="w">                     </span>-----
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>Seal<span class="w"> </span>Type<span class="w">               </span>shamir
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>Initialized<span class="w">             </span><span class="nb">true</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>Sealed<span class="w">                  </span><span class="nb">false</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>Total<span class="w"> </span>Shares<span class="w">            </span><span class="m">3</span>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>Threshold<span class="w">               </span><span class="m">2</span>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>Version<span class="w">                 </span><span class="m">1</span>.19.3
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>Build<span class="w"> </span>Date<span class="w">              </span><span class="m">2025</span>-04-29T10:34:52Z
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>Storage<span class="w"> </span>Type<span class="w">            </span>raft
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>Cluster<span class="w"> </span>Name<span class="w">            </span>vault-cluster-ebfc0d3a
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>Cluster<span class="w"> </span>ID<span class="w">              </span>7ec57d9a-8086-e22c-e1c3-79fcba04eee8
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>Removed<span class="w"> </span>From<span class="w"> </span>Cluster<span class="w">    </span><span class="nb">false</span>
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>HA<span class="w"> </span>Enabled<span class="w">              </span><span class="nb">true</span>
<a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>HA<span class="w"> </span>Cluster<span class="w">              </span>n/a
<a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a>HA<span class="w"> </span>Mode<span class="w">                 </span>standby
<a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>Active<span class="w"> </span>Node<span class="w"> </span>Address<span class="w">     </span>&lt;none&gt;
<a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a>Raft<span class="w"> </span>Committed<span class="w"> </span>Index<span class="w">    </span><span class="m">32</span>
<a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a>Raft<span class="w"> </span>Applied<span class="w"> </span>Index<span class="w">      </span><span class="m">32</span>
</code></pre></div>
<h3 id="join-vault-1-and-vault-2-node-to-vault-cluster">Join vault-1 and vault-2 node to Vault cluster</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>vault-1<span class="w"> </span>--<span class="w"> </span>vault<span class="w"> </span>operator<span class="w"> </span>raft<span class="w"> </span>join<span class="w"> </span>http://vault-0.vault-internal:8200
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>vault-2<span class="w"> </span>--<span class="w"> </span>vault<span class="w"> </span>operator<span class="w"> </span>raft<span class="w"> </span>join<span class="w"> </span>http://vault-0.vault-internal:8200
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="c1">## and unseal nodes</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>vault-1<span class="w"> </span>--<span class="w"> </span>vault<span class="w"> </span>operator<span class="w"> </span>unseal<span class="w"> </span>&lt;unsealkey1&gt;
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>vault-1<span class="w"> </span>--<span class="w"> </span>vault<span class="w"> </span>operator<span class="w"> </span>unseal<span class="w"> </span>&lt;unsealkey2&gt;
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>vault-2<span class="w"> </span>--<span class="w"> </span>vault<span class="w"> </span>operator<span class="w"> </span>unseal<span class="w"> </span>&lt;unsealkey1&gt;
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>vault-2<span class="w"> </span>--<span class="w"> </span>vault<span class="w"> </span>operator<span class="w"> </span>unseal<span class="w"> </span>&lt;unsealkey2&gt;
</code></pre></div>
<ul>
<li>check leader node
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>curl<span class="w"> </span>-s<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;X-Vault-Token: &lt;root_token&gt;&quot;</span><span class="w"> </span>http://127.0.0.1:8200/v1/sys/leader<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="c1"># view leader_cluster_address: xxx</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>or<span class="w"> </span>you<span class="w"> </span>can<span class="w"> </span>check<span class="w"> </span>on<span class="w"> </span>vault<span class="w"> </span>ui<span class="w"> </span>raft<span class="w"> </span>storage<span class="w"> </span>section<span class="w"> </span>on<span class="w"> </span>left<span class="w"> </span>handside
</code></pre></div></li>
</ul>
<h2 id="vault-installation-install-as-systemd-service">Vault Installation - install as systemd service</h2>
<h3 id="single-node-deployment">Single-Node Deployment</h3>
<ul>
<li>Using package manager</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>wget<span class="w"> </span>-O<span class="w"> </span>-<span class="w"> </span>https://apt.releases.hashicorp.com/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span>-o<span class="w"> </span>/usr/share/keyrings/hashicorp-archive-keyring.gpg
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [arch=</span><span class="k">$(</span>dpkg<span class="w"> </span>--print-architecture<span class="k">)</span><span class="s2"> signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> main&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/hashicorp.list
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>vault
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>Not:<span class="w"> </span><span class="c1"># binary path is /usr/bin/vault check that &quot;which vault&quot;</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>ls<span class="w"> </span>/usr/bin/vault
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>---
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>sudo<span class="w"> </span>tee<span class="w"> </span>/lib/systemd/system/vault.service<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="s">[Unit]</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="s">Description=&quot;HashiCorp Vault&quot;</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="s">Documentation=&quot;https://developer.hashicorp.com/vault/docs&quot;</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="s">ConditionFileNotEmpty=&quot;/etc/vault.d/vault.hcl&quot;</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="s">[Service]</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="s">User=vault</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="s">Group=vault</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="s">SecureBits=keep-caps</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="s">AmbientCapabilities=CAP_IPC_LOCK</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="s">CapabilityBoundingSet=CAP_SYSLOG CAP_IPC_LOCK</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="s">NoNewPrivileges=yes</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="s">ExecStart=/usr/bin/vault server -config=/etc/vault.d/vault.hcl</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="s">ExecReload=/bin/kill --signal HUP</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="s">KillMode=process</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="s">KillSignal=SIGINT</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="s">[Install]</span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="s">WantedBy=multi-user.target</span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="s">EOF</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1">## change &lt;vault-vm-ip&gt;</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="c1">## auto-unseal is active on AWS KMS for detail check auto-unseal section. if dont need delete seal &quot;awskms&quot; lines</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/vault.d/vault.hcl<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="s">storage &quot;raft&quot; {</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="s">  path    = &quot;/opt/vault/data&quot;</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="s">  node_id = &quot;vault-node&quot;</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="s">}</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="s">listener &quot;tcp&quot; {</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="s"> address = &quot;0.0.0.0:8200&quot; </span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="s"> cluster_address = &quot;0.0.0.0:8201&quot;</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="s"> tls_disable = 1</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="s">api_addr = &quot;http://&lt;vault-vm-ip&gt;:8200&quot;</span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="s">cluster_addr = &quot;http://&lt;vault-vm-ip&gt;:8201&quot;</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="s">ui = true</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="s">log_level = &quot;INFO&quot;</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="s">disable_mlock=true</span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="s">seal &quot;awskms&quot; {</span>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a><span class="s">  region     = &quot;eu-central-1&quot;</span>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a><span class="s">  access_key = &quot;xxx&quot;</span>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="s">  secret_key = &quot;xxx&quot;</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a><span class="s">  kms_key_id = &quot;xxx&quot;</span>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a><span class="s">}</span>
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a><span class="s">EOF</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># Create required directories</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/opt/vault/data
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/log/vault
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>vault:vault<span class="w"> </span>/opt/vault
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>vault:vault<span class="w"> </span>/var/log/vault
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>sudo<span class="w"> </span>chown<span class="w"> </span>vault:vault<span class="w"> </span>/etc/vault.d/vault.hcl
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">640</span><span class="w"> </span>/etc/vault.d/vault.hcl
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">750</span><span class="w">  </span>/var/log/vault
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="c1">#restart vault service</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>vault
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>vault
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>vault
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>vault<span class="w"> </span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="nb">export</span><span class="w"> </span><span class="nv">VAULT_ADDR</span><span class="o">=</span>http://&lt;vault-vm-ip&gt;:8200<span class="w"> </span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="c1">## check status vault before initialize</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>vault<span class="w"> </span>status
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>vault<span class="w"> </span>operator<span class="w"> </span>init<span class="w"> </span>-key-shares<span class="o">=</span><span class="m">3</span><span class="w"> </span>-key-threshold<span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="c1"># for 3 unseal key and 2 of them is required</span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>vault<span class="w"> </span>status
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a><span class="c1">## check vault cluster is healty</span>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>curl<span class="w"> </span>http://&lt;vault-vm-ip&gt;:8200/v1/sys/health
</code></pre></div>
<h3 id="high-availability-cluster">High Availability Cluster</h3>
<h4 id="run-on-node-1">Run on NODE-1</h4>
<ul>
<li>Using package manager</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>wget<span class="w"> </span>-O<span class="w"> </span>-<span class="w"> </span>https://apt.releases.hashicorp.com/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span>-o<span class="w"> </span>/usr/share/keyrings/hashicorp-archive-keyring.gpg
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [arch=</span><span class="k">$(</span>dpkg<span class="w"> </span>--print-architecture<span class="k">)</span><span class="s2"> signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> main&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/hashicorp.list
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>vault
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>Not:<span class="w"> </span><span class="c1"># binary path is /usr/bin/vault check that &quot;which vault&quot;</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>sudo<span class="w"> </span>tee<span class="w"> </span>/lib/systemd/system/vault.service<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="s">[Unit]</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="s">Description=&quot;HashiCorp Vault - A tool for managing secrets&quot;</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="s">Documentation=https://www.vaultproject.io/docs/</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="s">Requires=network-online.target</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="s">After=network-online.target</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="s">ConditionFileNotEmpty=/etc/vault.d/vault.hcl</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="s">StartLimitIntervalSec=60</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="s">StartLimitBurst=3</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="s">[Service]</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="s">User=vault</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="s">Group=vault</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="s">ProtectSystem=full</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="s">ProtectHome=read-only</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="s">PrivateTmp=yes</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="s">PrivateDevices=yes</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="s">SecureBits=keep-caps</span>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="s">AmbientCapabilities=CAP_IPC_LOCK</span>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="s">CapabilityBoundingSet=CAP_SYSLOG CAP_IPC_LOCK</span>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a><span class="s">NoNewPrivileges=yes</span>
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a><span class="s">ExecStart=/usr/bin/vault server -config=/etc/vault.d/vault.hcl</span>
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a><span class="s">ExecReload=/bin/kill --signal HUP \$MAINPID</span>
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a><span class="s">KillMode=process</span>
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a><span class="s">KillSignal=SIGINT</span>
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a><span class="s">Restart=on-failure</span>
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a><span class="s">RestartSec=5</span>
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a><span class="s">TimeoutStopSec=30</span>
<a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a><span class="s">LimitNOFILE=65536</span>
<a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a><span class="s">LimitMEMLOCK=infinity</span>
<a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a>
<a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a><span class="s">[Install]</span>
<a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a><span class="s">WantedBy=multi-user.target</span>
<a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a><span class="s">EOF</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1">## change &lt;node-x-ip&gt;</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="c1">## auto-unseal is active on AWS KMS for detail check auto-unseal section. if dont need delete seal &quot;awskms&quot; lines</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/vault.d/vault.hcl<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="s">storage &quot;raft&quot; {</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="s">  path    = &quot;/opt/vault/data&quot;</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="s">  node_id = &quot;vault-node-1&quot;</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="s">  retry_join {</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="s">    leader_api_addr = &quot;http://&lt;node-1-ip&gt;:8200&quot;</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="s">  }</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="s">  retry_join {</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="s">    leader_api_addr = &quot;http://&lt;node-2-ip&gt;:8200&quot;</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="s">  }</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="s">  retry_join {</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="s">    leader_api_addr = &quot;http://&lt;node-3-ip&gt;:8200&quot;</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="s">  }</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="s">}</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="s">listener &quot;tcp&quot; {</span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="s">address = &quot;&lt;node-1-ip&gt;:8200&quot; </span>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="s">cluster_address = &quot;&lt;node-1-ip&gt;:8201&quot;</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="s">tls_disable = 1</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="s">}</span>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a><span class="s">api_addr = &quot;http://&lt;node-1-ip&gt;:8200&quot;</span>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="s">cluster_addr = &quot;http://&lt;node-1-ip&gt;:8201&quot;</span>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="s">ui = true</span>
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="s">log_level = &quot;INFO&quot;</span>
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a>
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a><span class="s">disable_mlock=true</span>
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a>
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a><span class="s">seal &quot;awskms&quot; {</span>
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a><span class="s">  region     = &quot;eu-central-1&quot;</span>
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a><span class="s">  access_key = &quot;xxx&quot;</span>
<a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a><span class="s">  secret_key = &quot;xxx&quot;</span>
<a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a><span class="s">  kms_key_id = &quot;xxx&quot;</span>
<a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a><span class="s">}</span>
<a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a>
<a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a><span class="s">audit &quot;file&quot; {</span>
<a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a><span class="s">  path = &quot;/var/log/vault/audit.log&quot;</span>
<a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a><span class="s">  log_requests = true</span>
<a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a><span class="s">  log_responses = true</span>
<a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a><span class="s">}</span>
<a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a><span class="s">EOF</span>
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># Create required directories</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/opt/vault/data
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/log/vault
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="c1"># Set ownership and permissions</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>vault:vault<span class="w"> </span>/opt/vault
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>vault:vault<span class="w"> </span>/var/log/vault
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>sudo<span class="w"> </span>chown<span class="w"> </span>vault:vault<span class="w"> </span>/etc/vault.d/vault.hcl
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">640</span><span class="w"> </span>/etc/vault.d/vault.hcl
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">750</span><span class="w">  </span>/var/log/vault
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="c1"># Enable and start vault service</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>vault
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>vault
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>vault
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>vault<span class="w"> </span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="nb">export</span><span class="w"> </span><span class="nv">VAULT_ADDR</span><span class="o">=</span>http://&lt;node-1-ip&gt;:8200
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>vault<span class="w"> </span>status
</code></pre></div>
- initialize vault</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>vault<span class="w"> </span>operator<span class="w"> </span>init<span class="w"> </span>-key-shares<span class="o">=</span><span class="m">3</span><span class="w"> </span>-key-threshold<span class="o">=</span><span class="m">2</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>not:<span class="w"> </span>aws<span class="w"> </span>kms<span class="w"> </span>iin<span class="w"> </span><span class="m">5</span>-3<span class="w"> </span>olmal<span class="w"> </span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>vault<span class="w"> </span>status
</code></pre></div>
- check raft peer list</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>vault<span class="w"> </span>login<span class="w"> </span>&lt;root<span class="w"> </span>token&gt;
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>vault<span class="w"> </span>operator<span class="w"> </span>raft<span class="w"> </span>list-peers
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>root@GLMGVSM01:~#<span class="w"> </span>vault<span class="w"> </span>operator<span class="w"> </span>raft<span class="w"> </span>list-peers
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>Node<span class="w">            </span>Address<span class="w">             </span>State<span class="w">       </span>Voter
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>----<span class="w">            </span>-------<span class="w">             </span>-----<span class="w">       </span>-----
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>vault-node-1<span class="w">    </span>&lt;node-ip&gt;:8201<span class="w">    </span>leader<span class="w">      </span><span class="nb">true</span>
</code></pre></div>
<h4 id="run-on-node-2">Run on NODE-2</h4>
<ul>
<li>Using package manager</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>wget<span class="w"> </span>-O<span class="w"> </span>-<span class="w"> </span>https://apt.releases.hashicorp.com/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span>-o<span class="w"> </span>/usr/share/keyrings/hashicorp-archive-keyring.gpg
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [arch=</span><span class="k">$(</span>dpkg<span class="w"> </span>--print-architecture<span class="k">)</span><span class="s2"> signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> main&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/hashicorp.list
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>vault
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>Not:<span class="w"> </span><span class="c1"># binary path is /usr/bin/vault check that &quot;which vault&quot;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>sudo<span class="w"> </span>tee<span class="w"> </span>/lib/systemd/system/vault.service<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="s">[Unit]</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="s">Description=&quot;HashiCorp Vault - A tool for managing secrets&quot;</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="s">Documentation=https://www.vaultproject.io/docs/</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="s">Requires=network-online.target</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="s">After=network-online.target</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="s">ConditionFileNotEmpty=/etc/vault.d/vault.hcl</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="s">StartLimitIntervalSec=60</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="s">StartLimitBurst=3</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="s">[Service]</span>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="s">User=vault</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="s">Group=vault</span>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="s">ProtectSystem=full</span>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="s">ProtectHome=read-only</span>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="s">PrivateTmp=yes</span>
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="s">PrivateDevices=yes</span>
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="s">SecureBits=keep-caps</span>
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="s">AmbientCapabilities=CAP_IPC_LOCK</span>
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="s">CapabilityBoundingSet=CAP_SYSLOG CAP_IPC_LOCK</span>
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="s">NoNewPrivileges=yes</span>
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a><span class="s">ExecStart=/usr/bin/vault server -config=/etc/vault.d/vault.hcl</span>
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a><span class="s">ExecReload=/bin/kill --signal HUP \$MAINPID</span>
<a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a><span class="s">KillMode=process</span>
<a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a><span class="s">KillSignal=SIGINT</span>
<a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a><span class="s">Restart=on-failure</span>
<a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a><span class="s">RestartSec=5</span>
<a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a><span class="s">TimeoutStopSec=30</span>
<a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a><span class="s">LimitNOFILE=65536</span>
<a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a><span class="s">LimitMEMLOCK=infinity</span>
<a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a>
<a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a><span class="s">[Install]</span>
<a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a><span class="s">WantedBy=multi-user.target</span>
<a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a><span class="s">EOF</span>
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1">## change &lt;node-x-ip&gt;</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="c1">## auto-unseal is active on AWS KMS for detail check auto-unseal section. if dont need delete seal &quot;awskms&quot; lines</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/vault.d/vault.hcl<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="s">storage &quot;raft&quot; {</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="s">  path    = &quot;/opt/vault/data&quot;</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="s">  node_id = &quot;vault-node-2&quot;</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="s">  retry_join {</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="s">    leader_api_addr = &quot;http://&lt;node-1-ip&gt;:8200&quot;</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="s">  }</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="s">  retry_join {</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="s">    leader_api_addr = &quot;http://&lt;node-2-ip&gt;:8200&quot;</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="s">  }</span>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="s">  retry_join {</span>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="s">    leader_api_addr = &quot;http://&lt;node-3-ip&gt;:8200&quot;</span>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="s">  }</span>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="s">}</span>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="s">listener &quot;tcp&quot; {</span>
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="s">address = &quot;&lt;node-2-ip&gt;:8200&quot; </span>
<a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="s">cluster_address = &quot;&lt;node-2-ip&gt;:8201&quot;</span>
<a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="s">tls_disable = 1</span>
<a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="s">}</span>
<a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>
<a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a><span class="s">api_addr = &quot;http://&lt;node-2-ip&gt;:8200&quot;</span>
<a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a><span class="s">cluster_addr = &quot;http://&lt;node-2-ip&gt;:8201&quot;</span>
<a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a><span class="s">ui = true</span>
<a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a><span class="s">log_level = &quot;INFO&quot;</span>
<a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a>
<a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a><span class="s">disable_mlock=true</span>
<a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a>
<a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a><span class="s">seal &quot;awskms&quot; {</span>
<a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a><span class="s">  region     = &quot;eu-central-1&quot;</span>
<a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a><span class="s">  access_key = &quot;xxx&quot;</span>
<a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a><span class="s">  secret_key = &quot;xxx&quot;</span>
<a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a><span class="s">  kms_key_id = &quot;xxx&quot;</span>
<a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a><span class="s">}</span>
<a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a>
<a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a><span class="s">audit &quot;file&quot; {</span>
<a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a><span class="s">  path = &quot;/var/log/vault/audit.log&quot;</span>
<a id="__codelineno-20-42" name="__codelineno-20-42" href="#__codelineno-20-42"></a><span class="s">  log_requests = true</span>
<a id="__codelineno-20-43" name="__codelineno-20-43" href="#__codelineno-20-43"></a><span class="s">  log_responses = true</span>
<a id="__codelineno-20-44" name="__codelineno-20-44" href="#__codelineno-20-44"></a><span class="s">}</span>
<a id="__codelineno-20-45" name="__codelineno-20-45" href="#__codelineno-20-45"></a><span class="s">EOF</span>
</code></pre></div>
- create data and log path </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># Create required directories</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/opt/vault/data
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/log/vault
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="c1"># Set ownership and permissions</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>vault:vault<span class="w"> </span>/opt/vault
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>vault:vault<span class="w"> </span>/var/log/vault
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>sudo<span class="w"> </span>chown<span class="w"> </span>vault:vault<span class="w"> </span>/etc/vault.d/vault.hcl
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">640</span><span class="w"> </span>/etc/vault.d/vault.hcl
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">750</span><span class="w">  </span>/var/log/vault
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="c1"># Enable and start vault service</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>vault
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>vault
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>vault
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>vault<span class="w"> </span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="nb">export</span><span class="w"> </span><span class="nv">VAULT_ADDR</span><span class="o">=</span>http://&lt;node-2-ip&gt;:8200
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>vault<span class="w"> </span>status
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="c1"># After service starts, node will automatically join cluster via retry_join</span>
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a><span class="c1"># Check cluster status and unseal if needed</span>
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>vault<span class="w"> </span>operator<span class="w"> </span>unseal<span class="w"> </span>&lt;unsealkey1&gt;
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a>vault<span class="w"> </span>operator<span class="w"> </span>unseal<span class="w"> </span>&lt;unsealkey2&gt;
</code></pre></div>
<h4 id="run-on-node-3">Run on NODE-3</h4>
<ul>
<li>Using package manager</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>wget<span class="w"> </span>-O<span class="w"> </span>-<span class="w"> </span>https://apt.releases.hashicorp.com/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span>-o<span class="w"> </span>/usr/share/keyrings/hashicorp-archive-keyring.gpg
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [arch=</span><span class="k">$(</span>dpkg<span class="w"> </span>--print-architecture<span class="k">)</span><span class="s2"> signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> main&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/hashicorp.list
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>vault
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>Not:<span class="w"> </span><span class="c1"># binary path is /usr/bin/vault check that &quot;which vault&quot;</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>sudo<span class="w"> </span>tee<span class="w"> </span>/lib/systemd/system/vault.service<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="s">[Unit]</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="s">Description=&quot;HashiCorp Vault - A tool for managing secrets&quot;</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="s">Documentation=https://www.vaultproject.io/docs/</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="s">Requires=network-online.target</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="s">After=network-online.target</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="s">ConditionFileNotEmpty=/etc/vault.d/vault.hcl</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="s">StartLimitIntervalSec=60</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="s">StartLimitBurst=3</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="s">[Service]</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="s">User=vault</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="s">Group=vault</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="s">ProtectSystem=full</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="s">ProtectHome=read-only</span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="s">PrivateTmp=yes</span>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="s">PrivateDevices=yes</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="s">SecureBits=keep-caps</span>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a><span class="s">AmbientCapabilities=CAP_IPC_LOCK</span>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="s">CapabilityBoundingSet=CAP_SYSLOG CAP_IPC_LOCK</span>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a><span class="s">NoNewPrivileges=yes</span>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a><span class="s">ExecStart=/usr/bin/vault server -config=/etc/vault.d/vault.hcl</span>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a><span class="s">ExecReload=/bin/kill --signal HUP \$MAINPID</span>
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a><span class="s">KillMode=process</span>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a><span class="s">KillSignal=SIGINT</span>
<a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a><span class="s">Restart=on-failure</span>
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a><span class="s">RestartSec=5</span>
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a><span class="s">TimeoutStopSec=30</span>
<a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a><span class="s">LimitNOFILE=65536</span>
<a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a><span class="s">LimitMEMLOCK=infinity</span>
<a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a>
<a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a><span class="s">[Install]</span>
<a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a><span class="s">WantedBy=multi-user.target</span>
<a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a><span class="s">EOF</span>
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1">## change &lt;node-x-ip&gt;</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="c1">## auto-unseal is active on AWS KMS for detail check auto-unseal section. if dont need delete seal &quot;awskms&quot; lines</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/vault.d/vault.hcl<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="s">storage &quot;raft&quot; {</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="s">  path    = &quot;/opt/vault/data&quot;</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="s">  node_id = &quot;vault-node-3&quot;</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="s">  retry_join {</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="s">    leader_api_addr = &quot;http://&lt;node-1-ip&gt;:8200&quot;</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="s">  }</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="s">  retry_join {</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="s">    leader_api_addr = &quot;http://&lt;node-2-ip&gt;:8200&quot;</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="s">  }</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="s">  retry_join {</span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="s">    leader_api_addr = &quot;http://&lt;node-3-ip&gt;:8200&quot;</span>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="s">  }</span>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a><span class="s">}</span>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a><span class="s">listener &quot;tcp&quot; {</span>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a><span class="s">address = &quot;&lt;node-3-ip&gt;:8200&quot; </span>
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a><span class="s">cluster_address = &quot;&lt;node-3-ip&gt;:8201&quot;</span>
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a><span class="s">tls_disable = 1</span>
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a><span class="s">}</span>
<a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>
<a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a><span class="s">api_addr = &quot;http://&lt;node-3-ip&gt;:8200&quot;</span>
<a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a><span class="s">cluster_addr = &quot;http://&lt;node-3-ip&gt;:8201&quot;</span>
<a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a><span class="s">ui = true</span>
<a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a><span class="s">log_level = &quot;INFO&quot;</span>
<a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>
<a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a><span class="s">disable_mlock=true</span>
<a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>
<a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a><span class="s">seal &quot;awskms&quot; {</span>
<a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a><span class="s">  region     = &quot;eu-central-1&quot;</span>
<a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a><span class="s">  access_key = &quot;xxx&quot;</span>
<a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a><span class="s">  secret_key = &quot;xxx&quot;</span>
<a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a><span class="s">  kms_key_id = &quot;xxx&quot;</span>
<a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a><span class="s">}</span>
<a id="__codelineno-24-39" name="__codelineno-24-39" href="#__codelineno-24-39"></a>
<a id="__codelineno-24-40" name="__codelineno-24-40" href="#__codelineno-24-40"></a><span class="s">audit &quot;file&quot; {</span>
<a id="__codelineno-24-41" name="__codelineno-24-41" href="#__codelineno-24-41"></a><span class="s">  path = &quot;/var/log/vault/audit.log&quot;</span>
<a id="__codelineno-24-42" name="__codelineno-24-42" href="#__codelineno-24-42"></a><span class="s">  log_requests = true</span>
<a id="__codelineno-24-43" name="__codelineno-24-43" href="#__codelineno-24-43"></a><span class="s">  log_responses = true</span>
<a id="__codelineno-24-44" name="__codelineno-24-44" href="#__codelineno-24-44"></a><span class="s">}</span>
<a id="__codelineno-24-45" name="__codelineno-24-45" href="#__codelineno-24-45"></a><span class="s">EOF</span>
</code></pre></div>
- create data and log path </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># Create required directories</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/opt/vault/data
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/log/vault
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="c1"># Set ownership and permissions</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>vault:vault<span class="w"> </span>/opt/vault
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>vault:vault<span class="w"> </span>/var/log/vault
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>sudo<span class="w"> </span>chown<span class="w"> </span>vault:vault<span class="w"> </span>/etc/vault.d/vault.hcl
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">640</span><span class="w"> </span>/etc/vault.d/vault.hcl
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">750</span><span class="w">  </span>/var/log/vault
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="c1"># Enable and start vault service</span>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>vault
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>vault
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>vault
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>vault<span class="w"> </span>
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="nb">export</span><span class="w"> </span><span class="nv">VAULT_ADDR</span><span class="o">=</span>http://&lt;node-3-ip&gt;:8200
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>vault<span class="w"> </span>status
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a>
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a><span class="c1"># After service starts, node will automatically join cluster via retry_join</span>
<a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a><span class="c1"># Check cluster status and unseal if needed</span>
<a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a>vault<span class="w"> </span>operator<span class="w"> </span>unseal<span class="w"> </span>&lt;unsealkey1&gt;
<a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a>vault<span class="w"> </span>operator<span class="w"> </span>unseal<span class="w"> </span>&lt;unsealkey2&gt;
</code></pre></div>
<ul>
<li>verify complete cluster setup (final step)</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1"># Login with root token and verify all nodes joined the cluster</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>vault<span class="w"> </span>login<span class="w"> </span>&lt;root<span class="w"> </span>token&gt;
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>vault<span class="w"> </span>operator<span class="w"> </span>raft<span class="w"> </span>list-peers
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="c1"># Expected output showing all 3 nodes:</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="c1"># vault-node-1    &lt;node-1-ip&gt;:8201    leader      true</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="c1"># vault-node-2    &lt;node-2-ip&gt;:8201    follower    true  </span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="c1"># vault-node-3    &lt;node-3-ip&gt;:8201    follower    true</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="c1"># Verify cluster health</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>vault<span class="w"> </span>status
</code></pre></div>
<h2 id="auto-unseal">auto-unseal</h2>
<h3 id="for-k8s-deploymnet">for k8s deploymnet</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>vi<span class="w"> </span>ext-vault-values.yaml<span class="w"> </span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>and<span class="w"> </span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>add<span class="w"> </span>helm<span class="w"> </span>values<span class="w"> </span>config<span class="w"> </span>section<span class="w"> </span>this<span class="w"> </span>lines
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="w">  </span><span class="nt">ha</span><span class="p">:</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">    </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">    </span><span class="nt">raft</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">    </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">      </span><span class="no">ui = true</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">      </span><span class="no">listener &quot;tcp&quot; {</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w">        </span><span class="no">tls_disable = 1</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">        </span><span class="no">address = &quot;[::]:8200&quot;</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">        </span><span class="no">cluster_address = &quot;[::]:8201&quot;</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="w">      </span><span class="no">}</span>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="w">      </span><span class="no">storage &quot;raft&quot; {</span>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="w">          </span><span class="no">path = &quot;/vault/data&quot;</span>
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a><span class="w">          </span><span class="no">retry_join {</span>
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a><span class="w">            </span><span class="no">leader_api_addr = &quot;http://vault-0.vault-internal:8200&quot;</span>
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a><span class="w">          </span><span class="no">}</span>
<a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a><span class="w">          </span><span class="no">retry_join {</span>
<a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a><span class="w">            </span><span class="no">leader_api_addr = &quot;http://vault-1.vault-internal:8200&quot;</span>
<a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a><span class="w">          </span><span class="no">}</span>
<a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a><span class="w">          </span><span class="no">retry_join {</span>
<a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a><span class="w">            </span><span class="no">leader_api_addr = &quot;http://vault-2.vault-internal:8200&quot;</span>
<a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a><span class="w">          </span><span class="no">}</span>
<a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a><span class="w">        </span><span class="no">}</span>
<a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a>
<a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a><span class="w">      </span><span class="no">service_registration &quot;kubernetes&quot; {}</span>
<a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a><span class="w">      </span><span class="no">seal &quot;awskms&quot; {</span>
<a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a><span class="w">        </span><span class="no">region     = &quot;eu-central-1&quot;</span>
<a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a><span class="w">        </span><span class="no">access_key = &quot;xxx&quot;</span>
<a id="__codelineno-28-32" name="__codelineno-28-32" href="#__codelineno-28-32"></a><span class="w">        </span><span class="no">secret_key = &quot;xxx&quot;</span>
<a id="__codelineno-28-33" name="__codelineno-28-33" href="#__codelineno-28-33"></a><span class="w">        </span><span class="no">kms_key_id = &quot;xxx&quot;</span>
<a id="__codelineno-28-34" name="__codelineno-28-34" href="#__codelineno-28-34"></a><span class="w">      </span><span class="no">}</span>
</code></pre></div>
- helm upgrade 
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>helm<span class="w"> </span>upgrade<span class="w"> </span>--install<span class="w"> </span>vault<span class="w"> </span>hashicorp/vault<span class="w"> </span>--version<span class="w"> </span><span class="m">0</span>.30.0<span class="w"> </span>-f<span class="w"> </span>ext-vault-values.yaml
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>vault-0<span class="w"> </span>-n<span class="w"> </span>vault<span class="w"> </span>--<span class="w"> </span>sh
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="c1"># for one more time for unseal </span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>vault<span class="w"> </span>operator<span class="w"> </span>unseal<span class="w"> </span>-migrate
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>enter<span class="w"> </span>&lt;unsealkey1&gt;
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>enter<span class="w"> </span>&lt;unsealkey2&gt;
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>vault.service<span class="w"> </span>
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>vault<span class="w"> </span>status
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="c1"># show sealed: false</span>
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>Not:<span class="w"> </span>Need<span class="w"> </span>root<span class="w"> </span>token<span class="w"> </span>every<span class="w"> </span><span class="nb">time</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>Vault<span class="w"> </span>ui<span class="w"> </span>login
</code></pre></div>
<h3 id="for-systemd-service">for systemd service</h3>
<p>Not: In the /etc/vault.d/vault.hcl document for the Systemd service installation mentioned above, it's mandatory to enter the relevant auto unseal area. Afterward, the following steps must be taken:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># for one more time for unseal </span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>vault<span class="w"> </span>operator<span class="w"> </span>unseal<span class="w"> </span>-migrate
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>enter<span class="w"> </span>&lt;unsealkey1&gt;
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>enter<span class="w"> </span>&lt;unsealkey2&gt;
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>vault.service<span class="w"> </span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>vault<span class="w"> </span>status
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="c1"># show sealed: false</span>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>Not:<span class="w"> </span>Need<span class="w"> </span>root<span class="w"> </span>token<span class="w"> </span>every<span class="w"> </span><span class="nb">time</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>Vault<span class="w"> </span>ui<span class="w"> </span>login
</code></pre></div>
<h2 id="use-tls-for-systemd-service">use tls (for systemd service)</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/vault.d/vault.hcl
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="c1"># modified adress, listener, api_addr, cluster_addr section</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>listener<span class="w"> </span><span class="s2">&quot;tcp&quot;</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="w"> </span><span class="nv">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0.0.0.0:443&quot;</span><span class="w"> </span><span class="c1"># port 443</span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="w"> </span><span class="nv">cluster_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0.0.0.0:8201&quot;</span>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="w"> </span><span class="nv">tls_cert_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/etc/vault.d/certs/vault.crt&quot;</span><span class="w"> </span><span class="c1"># cert path </span>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="w"> </span><span class="nv">tls_key_file</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/etc/vault.d/certs/vault.key&quot;</span><span class="w"> </span><span class="c1"># key path</span>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="w"> </span><span class="nv">tls_disable</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1"># set 0 for tls enable</span>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="o">}</span>
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="nv">api_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://xxx.test.com:8200&quot;</span><span class="w"> </span><span class="c1"># use new dns</span>
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="nv">cluster_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://xxx.test.com:8201&quot;</span><span class="w"> </span><span class="c1"># use new dns</span>
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>
<a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a><span class="c1"># permission for bind service and run on 443, if not use port 8200 like https://xxx.test.com:8200</span>
<a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a>sudo<span class="w"> </span>setcap<span class="w"> </span><span class="s1">&#39;cap_net_bind_service=+ep&#39;</span><span class="w"> </span>/usr/local/bin/vault
<a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a>
<a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a>sudo<span class="w"> </span>openssl<span class="w"> </span>req<span class="w"> </span>-x509<span class="w"> </span>-nodes<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-newkey<span class="w"> </span>rsa:2048<span class="w"> </span>-keyout<span class="w"> </span>/etc/vault.d/certs/vault.key<span class="w"> </span>-out<span class="w"> </span>/etc/vault.d/certs/vault.crt<span class="w"> </span>-subj<span class="w"> </span><span class="s2">&quot;/CN=xxx.test.com&quot;</span>
<a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a>
<a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a>sudo<span class="w"> </span>nano<span class="w">  </span>/lib/systemd/system/vault.service
<a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a>
<a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a><span class="c1"># modified below lines</span>
<a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a><span class="nv">CapabilityBoundingSet</span><span class="o">=</span>CAP_IPC_LOCK<span class="w"> </span>CAP_NET_BIND_SERVICE
<a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a><span class="nv">AmbientCapabilities</span><span class="o">=</span>CAP_IPC_LOCK<span class="w"> </span>CAP_NET_BIND_SERVICE
<a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a>
<a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a>
<a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a><span class="c1"># restart vault service</span>
<a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
<a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>vault
<a id="__codelineno-32-30" name="__codelineno-32-30" href="#__codelineno-32-30"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>vault
<a id="__codelineno-32-31" name="__codelineno-32-31" href="#__codelineno-32-31"></a>
<a id="__codelineno-32-32" name="__codelineno-32-32" href="#__codelineno-32-32"></a><span class="c1"># verify tls connection</span>
<a id="__codelineno-32-33" name="__codelineno-32-33" href="#__codelineno-32-33"></a>
<a id="__codelineno-32-34" name="__codelineno-32-34" href="#__codelineno-32-34"></a>https://xxx.test.com
</code></pre></div>
<h2 id="ldap-integration-for-systemd-service">LDAP integration (for systemd service)</h2>
<p>The ldap auth method allows authentication using an existing LDAP server and user/password credentials. This allows Vault to be integrated into environments using LDAP without duplicating the user/pass configuration in multiple places.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>vault<span class="w"> </span>auth<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>ldap
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>vault<span class="w"> </span>write<span class="w"> </span>auth/ldap/config<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">    </span><span class="nv">url</span><span class="o">=</span><span class="s2">&quot;ldap://ldap.server.address&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">    </span><span class="nv">bind_dn</span><span class="o">=</span><span class="s2">&quot;cn=admin,dc=example,dc=com&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="w">    </span><span class="nv">bind_password</span><span class="o">=</span><span class="s2">&quot;admin_password&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="w">    </span><span class="nv">user_dn</span><span class="o">=</span><span class="s2">&quot;ou=users,dc=example,dc=com&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="w">    </span><span class="nv">group_dn</span><span class="o">=</span><span class="s2">&quot;ou=groups,dc=example,dc=com&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="w">    </span><span class="nv">user_attr</span><span class="o">=</span><span class="s2">&quot;uid&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="w">    </span><span class="nv">group_attr</span><span class="o">=</span><span class="s2">&quot;cn&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="w">    </span><span class="nv">group_filter</span><span class="o">=</span><span class="s2">&quot;(objectClass=groupOfNames)&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="w">    </span><span class="nv">group_base_dn</span><span class="o">=</span><span class="s2">&quot;ou=groups,dc=example,dc=com&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="w">    </span><span class="nv">insecure_tls</span><span class="o">=</span><span class="nb">true</span>
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>url: The address of the LDAP server.
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>bind_dn: The user used to bind (authenticate) to the LDAP directory.
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>bind_password: The password for the LDAP user specified in bind_dn.
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>user_dn: The distinguished name (DN) where user entries are located in the LDAP directory.
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>group_dn: The distinguished name (DN) where group entries are located in the LDAP directory.
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>user_attr: The LDAP attribute used to identify the user (e.g., uid).
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>group_attr: The LDAP attribute used to identify the group name (e.g., cn).
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>group_filter: The filter to identify LDAP group objects (e.g., (objectClass=groupOfNames)).
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>group_base_dn: The base distinguished name for groups in the LDAP directory.
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>insecure_tls: If you are not using TLS, set this to true.
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>nano<span class="w"> </span>ldap-users-policy.hcl
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>--
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>path<span class="w"> </span><span class="s2">&quot;auth/ldap/login/*&quot;</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="w">  </span><span class="nv">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;read&quot;</span>,<span class="w"> </span><span class="s2">&quot;update&quot;</span><span class="o">]</span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="o">}</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>path<span class="w"> </span><span class="s2">&quot;kv/*&quot;</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="w">  </span><span class="nv">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;read&quot;</span><span class="o">]</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="o">}</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>path<span class="w"> </span><span class="s2">&quot;kv/data/*&quot;</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">  </span><span class="nv">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;read&quot;</span><span class="o">]</span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="o">}</span>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>path<span class="w"> </span><span class="s2">&quot;kv/metadata/*&quot;</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="w">  </span><span class="nv">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;read&quot;</span><span class="o">]</span>
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="o">}</span>
<a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a>path<span class="w"> </span><span class="s2">&quot;sys/mounts/*&quot;</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="w">  </span><span class="nv">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;create&quot;</span>,<span class="w"> </span><span class="s2">&quot;read&quot;</span>,<span class="w"> </span><span class="s2">&quot;update&quot;</span>,<span class="w"> </span><span class="s2">&quot;delete&quot;</span>,<span class="w"> </span><span class="s2">&quot;list&quot;</span>,<span class="w"> </span><span class="s2">&quot;sudo&quot;</span><span class="o">]</span>
<a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="o">}</span>
<a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a>path<span class="w"> </span><span class="s2">&quot;sys/mounts&quot;</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a><span class="w">  </span><span class="nv">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;read&quot;</span><span class="o">]</span>
<a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a><span class="o">}</span>
<a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a>--
<a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a>vault<span class="w"> </span>policy<span class="w"> </span>write<span class="w"> </span>ldap-users-policy<span class="w"> </span>ldap-users-policy.hcl
<a id="__codelineno-35-24" name="__codelineno-35-24" href="#__codelineno-35-24"></a>
<a id="__codelineno-35-25" name="__codelineno-35-25" href="#__codelineno-35-25"></a>vault<span class="w"> </span>write<span class="w"> </span>auth/ldap/groups/&lt;ldap_groups&gt;<span class="w"> </span><span class="nv">policies</span><span class="o">=</span><span class="s2">&quot;default,ldap-users-policy&quot;</span>
<a id="__codelineno-35-26" name="__codelineno-35-26" href="#__codelineno-35-26"></a>
<a id="__codelineno-35-27" name="__codelineno-35-27" href="#__codelineno-35-27"></a><span class="c1">#test ldap user login </span>
<a id="__codelineno-35-28" name="__codelineno-35-28" href="#__codelineno-35-28"></a>vault<span class="w"> </span>login<span class="w"> </span>-method<span class="o">=</span>ldap<span class="w"> </span><span class="nv">username</span><span class="o">=</span>ldap-username<span class="w"> </span><span class="nv">password</span><span class="o">=</span>password
</code></pre></div></p>
<h2 id="auth-kubernetes-enable">auth-kubernetes enable</h2>
<h3 id="kubernetes-side-configuration">Kubernetes side configuration</h3>
<p>Prerequisites:
- External Secrets Operator (ESO) must be installed on Kubernetes cluster</p>
<h4 id="step-1-create-service-account-and-rbac">Step 1: Create Service Account and RBAC</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1"># Define service account for ESO-Vault integration with proper RBAC permissions</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="c1"># This service account allows ESO to authenticate with Vault and manage Kubernetes secrets</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="l l-Scalar l-Scalar-Plain">vi vault-sa.yaml</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-secrets-sa</span>
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eso</span>
<a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>
<a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="nn">---</span>
<a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a><span class="c1"># ClusterRoleBinding links the service account to the cluster role</span>
<a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-secrets-binding</span>
<a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a><span class="nt">roleRef</span><span class="p">:</span>
<a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a><span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">system:auth-delegator</span>
<a id="__codelineno-36-22" name="__codelineno-36-22" href="#__codelineno-36-22"></a><span class="nt">subjects</span><span class="p">:</span>
<a id="__codelineno-36-23" name="__codelineno-36-23" href="#__codelineno-36-23"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<a id="__codelineno-36-24" name="__codelineno-36-24" href="#__codelineno-36-24"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-secrets-sa</span>
<a id="__codelineno-36-25" name="__codelineno-36-25" href="#__codelineno-36-25"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eso</span>
</code></pre></div>
<p>Apply the service account configuration:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>vault-sa.yaml
</code></pre></div>
<h4 id="step-2-create-service-account-token">Step 2: Create Service Account Token</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1"># For Kubernetes 1.24+, manual token creation is required</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="c1"># This secret contains the JWT token for service account authentication</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="l l-Scalar l-Scalar-Plain">vi vault-sa-token.yaml</span>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-secrets-sa-token</span>
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eso</span>
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="w">    </span><span class="nt">kubernetes.io/service-account.name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-secrets-sa</span>
<a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/service-account-token</span>
</code></pre></div>
<p>Apply the token secret:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>vault-sa-token.yaml
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="c1"># Verify token creation</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>external-secrets-sa-token<span class="w"> </span>-n<span class="w"> </span>eso
</code></pre></div>
<h3 id="vault-server-side-configuration-only-using-by-single-cluster">Vault server side configuration (only using by single cluster)</h3>
<p><strong>Note:</strong> The following configuration is for <strong>single cluster</strong> setup only. If you need to connect multiple Kubernetes clusters to Vault, skip this section and go directly to <a href="#multiple-clusters-configuration">Multiple Clusters Configuration</a>.</p>
<h4 id="step-3-enable-kubernetes-auth-method">Step 3: Enable Kubernetes Auth Method</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># Enable Kubernetes authentication method in Vault</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>vault<span class="w"> </span>auth<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>kubernetes
</code></pre></div>
<h4 id="step-4-configure-kubernetes-auth">Step 4: Configure Kubernetes Auth</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="c1"># Configure Vault with Kubernetes cluster information</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="c1"># Replace placeholders with actual values from your environment</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>vault<span class="w"> </span>write<span class="w"> </span>auth/kubernetes/config<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">    </span><span class="nv">token_reviewer_jwt</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>external-secrets-sa-token<span class="w"> </span>-n<span class="w"> </span>eso<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.token}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">    </span><span class="nv">kubernetes_host</span><span class="o">=</span><span class="s2">&quot;https://YOUR-K8S-API-SERVER:6443&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">    </span><span class="nv">kubernetes_ca_cert</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>cat<span class="w"> </span>/tmp/k8s-ca.crt<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="w">    </span><span class="nv">disable_iss_validation</span><span class="o">=</span><span class="nb">true</span>
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="c1"># Verify configuration</span>
<a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a>vault<span class="w"> </span><span class="nb">read</span><span class="w"> </span>auth/kubernetes/config
</code></pre></div>
<h4 id="step-5-create-vault-policy">Step 5: Create Vault Policy</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c1"># Create policy file defining permissions for ESO</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>vi<span class="w"> </span>eso-policy.hcl
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>path<span class="w"> </span><span class="s2">&quot;kv/data/*&quot;</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="w">  </span><span class="nv">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;read&quot;</span><span class="o">]</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="o">}</span>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>path<span class="w"> </span><span class="s2">&quot;kv/metadata/*&quot;</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="w">  </span><span class="nv">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;read&quot;</span><span class="o">]</span>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="o">}</span>
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a><span class="c1"># Apply the policy to Vault</span>
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>vault<span class="w"> </span>policy<span class="w"> </span>write<span class="w"> </span>eso-policy<span class="w"> </span>eso-policy.hcl
<a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a>
<a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a><span class="c1"># Verify policy creation</span>
<a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a>vault<span class="w"> </span><span class="nb">read</span><span class="w"> </span>sys/policy/eso-policy
</code></pre></div>
<h4 id="step-6-create-kubernetes-role">Step 6: Create Kubernetes Role</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="c1"># Create role binding service account to Vault policy</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="c1"># This role allows the specified service account to authenticate with Vault</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>vault<span class="w"> </span>write<span class="w"> </span>auth/kubernetes/role/eso-role<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="w">    </span><span class="nv">bound_service_account_names</span><span class="o">=</span>external-secrets-sa<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="w">    </span><span class="nv">bound_service_account_namespaces</span><span class="o">=</span>eso<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="w">    </span><span class="nv">policies</span><span class="o">=</span>eso-policy<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="w">    </span><span class="nv">ttl</span><span class="o">=</span>24h
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>
<a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="c1"># Verify role creation</span>
<a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a>vault<span class="w"> </span><span class="nb">read</span><span class="w"> </span>auth/kubernetes/role/eso-role
</code></pre></div>
<h4 id="step-7-test-authentication">Step 7: Test Authentication</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="c1"># Test authentication with the service account token</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="nv">TOKEN</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>external-secrets-sa-token<span class="w"> </span>-n<span class="w"> </span>eso<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.token}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d<span class="k">)</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>vault<span class="w"> </span>write<span class="w"> </span>auth/kubernetes/login<span class="w"> </span><span class="nv">role</span><span class="o">=</span>eso-role<span class="w"> </span><span class="nv">jwt</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TOKEN</span><span class="s2">&quot;</span>
</code></pre></div>
<h3 id="multiple-clusters-configuration">Multiple Clusters Configuration</h3>
<p>When you need to connect multiple Kubernetes clusters to a single Vault instance, each cluster requires its own auth path, policy, and role configuration.</p>
<h4 id="cluster-1-configuration">Cluster 1 Configuration</h4>
<h5 id="step-1-enable-kubernetes-auth-for-cluster-1">Step 1: Enable Kubernetes Auth for Cluster 1</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="c1"># Enable Kubernetes authentication method for cluster 1</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>vault<span class="w"> </span>auth<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>-path<span class="o">=</span>kubernetes/cluster1<span class="w"> </span>kubernetes
</code></pre></div>
<h5 id="step-2-create-policy-for-cluster-1">Step 2: Create Policy for Cluster 1</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="c1"># Create policy file for cluster 1</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>vi<span class="w"> </span>cluster1-eso-policy.hcl
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="c1"># Policy for cluster1 - allows access to cluster1 specific secrets</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="err">path</span><span class="w"> </span><span class="s2">&quot;cluster1/data/*&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">  </span><span class="na">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">]</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="p">}</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="err">path</span><span class="w"> </span><span class="s2">&quot;cluster1/metadata/*&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">  </span><span class="na">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">]</span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="c1"># Apply the policy to Vault</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>vault<span class="w"> </span>policy<span class="w"> </span>write<span class="w"> </span>cluster1-eso-policy<span class="w"> </span>cluster1-eso-policy.hcl
</code></pre></div>
<h5 id="step-3-configure-kubernetes-auth-for-cluster-1">Step 3: Configure Kubernetes Auth for Cluster 1</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c1"># Get cluster 1 credentials (from cluster 1 context)</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>kubectl<span class="w"> </span>config<span class="w"> </span>use-context<span class="w"> </span>cluster1-context
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>external-secrets-sa-token<span class="w"> </span>-n<span class="w"> </span>eso<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.token}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d<span class="w"> </span>&gt;<span class="w"> </span>/tmp/cluster1-token.jwt
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>external-secrets-sa-token<span class="w"> </span>-n<span class="w"> </span>eso<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.ca\.crt}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d<span class="w"> </span>&gt;<span class="w"> </span>/tmp/cluster1-ca.crt
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="nv">CLUSTER1_HOST</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>config<span class="w"> </span>view<span class="w"> </span>--minify<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.clusters[0].cluster.server}&#39;</span><span class="k">)</span>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="c1"># Configure Vault with Cluster 1 information</span>
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a>vault<span class="w"> </span>write<span class="w"> </span>auth/kubernetes/cluster1/config<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="w">    </span><span class="nv">token_reviewer_jwt</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>cat<span class="w"> </span>/tmp/cluster1-token.jwt<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="w">    </span><span class="nv">kubernetes_host</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$CLUSTER1_HOST</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="w">    </span><span class="nv">kubernetes_ca_cert</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>cat<span class="w"> </span>/tmp/cluster1-ca.crt<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="w">    </span><span class="nv">disable_iss_validation</span><span class="o">=</span><span class="nb">true</span>
</code></pre></div>
<h5 id="step-4-create-role-for-cluster-1">Step 4: Create Role for Cluster 1</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c1"># Create role for cluster 1</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>vault<span class="w"> </span>write<span class="w"> </span>auth/kubernetes/cluster1/role/cluster1-eso-role<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">    </span><span class="nv">bound_service_account_names</span><span class="o">=</span>external-secrets-sa<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="w">    </span><span class="nv">bound_service_account_namespaces</span><span class="o">=</span>eso<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="w">    </span><span class="nv">policies</span><span class="o">=</span>cluster1-eso-policy<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="w">    </span><span class="nv">ttl</span><span class="o">=</span>24h<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="w">    </span><span class="nv">audience</span><span class="o">=</span>vault
</code></pre></div>
<h5 id="step-5-test-authentication-for-cluster-1">Step 5: Test Authentication for Cluster 1</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="c1"># Test authentication for cluster 1</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>vault<span class="w"> </span>write<span class="w"> </span>auth/kubernetes/cluster1/login<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="w">    </span><span class="nv">role</span><span class="o">=</span>cluster1-eso-role<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="w">    </span><span class="nv">jwt</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>cat<span class="w"> </span>/tmp/cluster1-token.jwt<span class="k">)</span><span class="s2">&quot;</span>
</code></pre></div>
<h4 id="cluster-2-configuration">Cluster 2 Configuration</h4>
<h5 id="step-1-enable-kubernetes-auth-for-cluster-2">Step 1: Enable Kubernetes Auth for Cluster 2</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="c1"># Enable Kubernetes authentication method for cluster 2</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>vault<span class="w"> </span>auth<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>-path<span class="o">=</span>kubernetes/cluster2<span class="w"> </span>kubernetes
</code></pre></div>
<h5 id="step-2-create-policy-for-cluster-2">Step 2: Create Policy for Cluster 2</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="c1"># Create policy file for cluster 2</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>vi<span class="w"> </span>cluster2-eso-policy.hcl
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="c1"># Policy for cluster2 - allows access to cluster2 specific secrets</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="err">path</span><span class="w"> </span><span class="s2">&quot;cluster2/data/*&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="w">  </span><span class="na">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">]</span>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="p">}</span>
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="err">path</span><span class="w"> </span><span class="s2">&quot;cluster2/metadata/*&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="w">  </span><span class="na">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">]</span>
<a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="c1"># Apply the policy to Vault</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>vault<span class="w"> </span>policy<span class="w"> </span>write<span class="w"> </span>cluster2-eso-policy<span class="w"> </span>cluster2-eso-policy.hcl
</code></pre></div>
<h5 id="step-3-configure-kubernetes-auth-for-cluster-2">Step 3: Configure Kubernetes Auth for Cluster 2</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="c1"># Get cluster 2 credentials (from cluster 2 context)</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>kubectl<span class="w"> </span>config<span class="w"> </span>use-context<span class="w"> </span>cluster2-context
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>external-secrets-sa-token<span class="w"> </span>-n<span class="w"> </span>eso<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.token}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d<span class="w"> </span>&gt;<span class="w"> </span>/tmp/cluster2-token.jwt
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>external-secrets-sa-token<span class="w"> </span>-n<span class="w"> </span>eso<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.ca\.crt}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d<span class="w"> </span>&gt;<span class="w"> </span>/tmp/cluster2-ca.crt
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="nv">CLUSTER2_HOST</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>config<span class="w"> </span>view<span class="w"> </span>--minify<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.clusters[0].cluster.server}&#39;</span><span class="k">)</span>
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a>
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="c1"># Configure Vault with Cluster 2 information</span>
<a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a>vault<span class="w"> </span>write<span class="w"> </span>auth/kubernetes/cluster2/config<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="w">    </span><span class="nv">token_reviewer_jwt</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>cat<span class="w"> </span>/tmp/cluster2-token.jwt<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a><span class="w">    </span><span class="nv">kubernetes_host</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$CLUSTER2_HOST</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a><span class="w">    </span><span class="nv">kubernetes_ca_cert</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>cat<span class="w"> </span>/tmp/cluster2-ca.crt<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a><span class="w">    </span><span class="nv">disable_iss_validation</span><span class="o">=</span><span class="nb">true</span>
</code></pre></div>
<h5 id="step-4-create-role-for-cluster-2">Step 4: Create Role for Cluster 2</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="c1"># Create role for cluster 2</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>vault<span class="w"> </span>write<span class="w"> </span>auth/kubernetes/cluster2/role/cluster2-eso-role<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="w">    </span><span class="nv">bound_service_account_names</span><span class="o">=</span>external-secrets-sa<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="w">    </span><span class="nv">bound_service_account_namespaces</span><span class="o">=</span>eso<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="w">    </span><span class="nv">policies</span><span class="o">=</span>cluster2-eso-policy<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="w">    </span><span class="nv">ttl</span><span class="o">=</span>24h<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="w">    </span><span class="nv">audience</span><span class="o">=</span>vault
</code></pre></div>
<h5 id="step-5-test-authentication-for-cluster-2">Step 5: Test Authentication for Cluster 2</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="c1"># Test authentication for cluster 2</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>vault<span class="w"> </span>write<span class="w"> </span>auth/kubernetes/cluster2/login<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="w">    </span><span class="nv">role</span><span class="o">=</span>cluster2-eso-role<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="w">    </span><span class="nv">jwt</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>cat<span class="w"> </span>/tmp/cluster2-token.jwt<span class="k">)</span><span class="s2">&quot;</span>
</code></pre></div>
<h4 id="verification-commands-for-multiple-clusters">Verification Commands for Multiple Clusters</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="c1"># List all authentication methods</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>vault<span class="w"> </span>auth<span class="w"> </span>list
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="c1"># Check cluster 1 config</span>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a>vault<span class="w"> </span><span class="nb">read</span><span class="w"> </span>auth/kubernetes/cluster1/config
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a>vault<span class="w"> </span><span class="nb">read</span><span class="w"> </span>auth/kubernetes/cluster1/role/cluster1-eso-role
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>
<a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="c1"># Check cluster 2 config</span>
<a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a>vault<span class="w"> </span><span class="nb">read</span><span class="w"> </span>auth/kubernetes/cluster2/config
<a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a>vault<span class="w"> </span><span class="nb">read</span><span class="w"> </span>auth/kubernetes/cluster2/role/cluster2-eso-role
</code></pre></div>
<h4 id="clustersecretstore-configuration-for-each-cluster">ClusterSecretStore Configuration for Each Cluster</h4>
<h5 id="cluster-1-clustersecretstore">Cluster 1 ClusterSecretStore</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-secrets.io/v1beta1</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterSecretStore</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vault-cluster1-secretstore</span>
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="w">  </span><span class="nt">provider</span><span class="p">:</span>
<a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="w">    </span><span class="nt">vault</span><span class="p">:</span>
<a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="w">      </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://vault-ip:8200&quot;</span><span class="w">  </span><span class="c1"># CHANGE ME: Replace with actual Vault server IP or FQDN</span>
<a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cluster1&quot;</span>
<a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a><span class="w">      </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2</span>
<a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a><span class="w">      </span><span class="nt">auth</span><span class="p">:</span>
<a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a><span class="w">        </span><span class="nt">kubernetes</span><span class="p">:</span>
<a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;kubernetes/cluster1&quot;</span>
<a id="__codelineno-60-14" name="__codelineno-60-14" href="#__codelineno-60-14"></a><span class="w">          </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cluster1-eso-role&quot;</span>
<a id="__codelineno-60-15" name="__codelineno-60-15" href="#__codelineno-60-15"></a><span class="w">          </span><span class="nt">serviceAccountRef</span><span class="p">:</span>
<a id="__codelineno-60-16" name="__codelineno-60-16" href="#__codelineno-60-16"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-secrets-sa</span>
<a id="__codelineno-60-17" name="__codelineno-60-17" href="#__codelineno-60-17"></a><span class="w">            </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eso</span>
<a id="__codelineno-60-18" name="__codelineno-60-18" href="#__codelineno-60-18"></a><span class="w">          </span><span class="nt">secretRef</span><span class="p">:</span>
<a id="__codelineno-60-19" name="__codelineno-60-19" href="#__codelineno-60-19"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-secrets-sa-token</span><span class="w">              </span><span class="c1"># Token secret reference</span>
<a id="__codelineno-60-20" name="__codelineno-60-20" href="#__codelineno-60-20"></a><span class="w">            </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eso</span>
<a id="__codelineno-60-21" name="__codelineno-60-21" href="#__codelineno-60-21"></a><span class="w">            </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">token</span>
</code></pre></div>
<h5 id="cluster-2-clustersecretstore">Cluster 2 ClusterSecretStore</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-secrets.io/v1beta1</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterSecretStore</span>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vault-cluster2-secretstore</span>
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="w">  </span><span class="nt">provider</span><span class="p">:</span>
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="w">    </span><span class="nt">vault</span><span class="p">:</span>
<a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a><span class="w">      </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://vault-ip:8200&quot;</span><span class="w">  </span><span class="c1"># CHANGE ME: Replace with actual Vault server IP or FQDN</span>
<a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cluster2&quot;</span>
<a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a><span class="w">      </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2</span>
<a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a><span class="w">      </span><span class="nt">auth</span><span class="p">:</span>
<a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a><span class="w">        </span><span class="nt">kubernetes</span><span class="p">:</span>
<a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;kubernetes/cluster2&quot;</span>
<a id="__codelineno-61-14" name="__codelineno-61-14" href="#__codelineno-61-14"></a><span class="w">          </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cluster2-eso-role&quot;</span>
<a id="__codelineno-61-15" name="__codelineno-61-15" href="#__codelineno-61-15"></a><span class="w">          </span><span class="nt">serviceAccountRef</span><span class="p">:</span>
<a id="__codelineno-61-16" name="__codelineno-61-16" href="#__codelineno-61-16"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-secrets-sa</span>
<a id="__codelineno-61-17" name="__codelineno-61-17" href="#__codelineno-61-17"></a><span class="w">            </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eso</span>
<a id="__codelineno-61-18" name="__codelineno-61-18" href="#__codelineno-61-18"></a><span class="w">          </span><span class="nt">secretRef</span><span class="p">:</span>
<a id="__codelineno-61-19" name="__codelineno-61-19" href="#__codelineno-61-19"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-secrets-sa-token</span><span class="w">              </span><span class="c1"># Token secret reference</span>
<a id="__codelineno-61-20" name="__codelineno-61-20" href="#__codelineno-61-20"></a><span class="w">            </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eso</span>
<a id="__codelineno-61-21" name="__codelineno-61-21" href="#__codelineno-61-21"></a><span class="w">            </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">token</span>
</code></pre></div>
<h4 id="secret-engines-for-each-cluster">Secret Engines for Each Cluster</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="c1"># Enable KV secret engines for each cluster</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>vault<span class="w"> </span>secrets<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>-path<span class="o">=</span>cluster1<span class="w"> </span>kv-v2
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a>vault<span class="w"> </span>secrets<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>-path<span class="o">=</span>cluster2<span class="w"> </span>kv-v2
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="c1"># Create sample secrets for testing</span>
<a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a>vault<span class="w"> </span>kv<span class="w"> </span>put<span class="w"> </span>cluster1/database<span class="w"> </span><span class="nv">username</span><span class="o">=</span><span class="s2">&quot;cluster1-db-user&quot;</span><span class="w"> </span><span class="nv">password</span><span class="o">=</span><span class="s2">&quot;cluster1-db-pass&quot;</span>
<a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a>vault<span class="w"> </span>kv<span class="w"> </span>put<span class="w"> </span>cluster2/database<span class="w"> </span><span class="nv">username</span><span class="o">=</span><span class="s2">&quot;cluster2-db-user&quot;</span><span class="w"> </span><span class="nv">password</span><span class="o">=</span><span class="s2">&quot;cluster2-db-pass&quot;</span>
</code></pre></div>
<h3 id="kubernetes-side-create-clustersecretstore">Kubernetes side - Create ClusterSecretStore</h3>
<h4 id="step-8-create-clustersecretstore">Step 8: Create ClusterSecretStore</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="c1"># Define ClusterSecretStore for ESO-Vault integration</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="c1"># ClusterSecretStore can be accessed from all namespaces (unlike SecretStore which is namespace-scoped)</span>
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="l l-Scalar l-Scalar-Plain">vi clustersecretstore-sa.yaml</span>
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a>
<a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-secrets.io/v1beta1</span>
<a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterSecretStore</span>
<a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vault-nonprod-serviceaccount</span>
<a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a><span class="w">  </span><span class="nt">provider</span><span class="p">:</span>
<a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a><span class="w">    </span><span class="nt">vault</span><span class="p">:</span>
<a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a><span class="w">      </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://your-vault-server.example.com</span><span class="w"> </span><span class="c1"># Vault server URL</span>
<a id="__codelineno-63-14" name="__codelineno-63-14" href="#__codelineno-63-14"></a><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;kv&quot;</span><span class="w">                                         </span><span class="c1"># Vault secret engine path</span>
<a id="__codelineno-63-15" name="__codelineno-63-15" href="#__codelineno-63-15"></a><span class="w">      </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2</span><span class="w">                                        </span><span class="c1"># KV engine version</span>
<a id="__codelineno-63-16" name="__codelineno-63-16" href="#__codelineno-63-16"></a><span class="w">      </span><span class="nt">auth</span><span class="p">:</span>
<a id="__codelineno-63-17" name="__codelineno-63-17" href="#__codelineno-63-17"></a><span class="w">        </span><span class="nt">kubernetes</span><span class="p">:</span>
<a id="__codelineno-63-18" name="__codelineno-63-18" href="#__codelineno-63-18"></a><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;kubernetes&quot;</span><span class="w">                        </span><span class="c1"># Vault auth method path</span>
<a id="__codelineno-63-19" name="__codelineno-63-19" href="#__codelineno-63-19"></a><span class="w">          </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eso-role&quot;</span><span class="w">                              </span><span class="c1"># Vault role name</span>
<a id="__codelineno-63-20" name="__codelineno-63-20" href="#__codelineno-63-20"></a><span class="w">          </span><span class="nt">serviceAccountRef</span><span class="p">:</span>
<a id="__codelineno-63-21" name="__codelineno-63-21" href="#__codelineno-63-21"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-secrets-sa</span><span class="w">                    </span><span class="c1"># Kubernetes service account</span>
<a id="__codelineno-63-22" name="__codelineno-63-22" href="#__codelineno-63-22"></a><span class="w">            </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eso</span>
<a id="__codelineno-63-23" name="__codelineno-63-23" href="#__codelineno-63-23"></a><span class="w">          </span><span class="nt">secretRef</span><span class="p">:</span>
<a id="__codelineno-63-24" name="__codelineno-63-24" href="#__codelineno-63-24"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-secrets-sa-token</span><span class="w">              </span><span class="c1"># Token secret reference</span>
<a id="__codelineno-63-25" name="__codelineno-63-25" href="#__codelineno-63-25"></a><span class="w">            </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eso</span>
<a id="__codelineno-63-26" name="__codelineno-63-26" href="#__codelineno-63-26"></a><span class="w">            </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">token</span>
</code></pre></div>
<p>Apply the ClusterSecretStore:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>clustersecretstore-sa.yaml
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="c1"># Verify ClusterSecretStore creation</span>
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>kubectl<span class="w"> </span>get<span class="w"> </span>ClusterSecretStore
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>
<a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="c1"># Check status - should show &quot;Valid&quot;</span>
<a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a>kubectl<span class="w"> </span>describe<span class="w"> </span>ClusterSecretStore<span class="w"> </span>vault-nonprod-serviceaccount
</code></pre></div>
<h3 id="testing-the-integration">Testing the Integration</h3>
<h4 id="step-9-create-test-secret-in-vault">Step 9: Create Test Secret in Vault</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="c1"># Create a test secret in Vault for validation</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>vault<span class="w"> </span>kv<span class="w"> </span>put<span class="w"> </span>kv/test<span class="w"> </span>vault-username<span class="o">=</span><span class="s2">&quot;test-username-123&quot;</span>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="c1"># Verify secret creation</span>
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>vault<span class="w"> </span>kv<span class="w"> </span>get<span class="w"> </span>kv/test
</code></pre></div>
<h4 id="step-10-create-externalsecret-for-testing">Step 10: Create ExternalSecret for Testing</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="c1"># ExternalSecret resource converts Vault secrets to Kubernetes secrets</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="l l-Scalar l-Scalar-Plain">vi externalsecret.yaml</span>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-secrets.io/v1beta1</span>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ExternalSecret</span>
<a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vault-example</span>
<a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eso</span>
<a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a><span class="w">  </span><span class="nt">refreshInterval</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;30s&quot;</span><span class="w">                              </span><span class="c1"># Secret refresh interval</span>
<a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a><span class="w">  </span><span class="nt">secretStoreRef</span><span class="p">:</span>
<a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vault-nonprod-serviceaccount</span><span class="w">               </span><span class="c1"># ClusterSecretStore reference</span>
<a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a><span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterSecretStore</span>
<a id="__codelineno-66-14" name="__codelineno-66-14" href="#__codelineno-66-14"></a><span class="w">  </span><span class="nt">target</span><span class="p">:</span>
<a id="__codelineno-66-15" name="__codelineno-66-15" href="#__codelineno-66-15"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">devops-test</span><span class="w">                                </span><span class="c1"># Kubernetes secret name to create</span>
<a id="__codelineno-66-16" name="__codelineno-66-16" href="#__codelineno-66-16"></a><span class="w">    </span><span class="nt">creationPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Owner</span><span class="w">                            </span><span class="c1"># Secret ownership policy</span>
<a id="__codelineno-66-17" name="__codelineno-66-17" href="#__codelineno-66-17"></a><span class="w">  </span><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-66-18" name="__codelineno-66-18" href="#__codelineno-66-18"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretKey</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s-username</span><span class="w">                              </span><span class="c1"># Key name in Kubernetes secret</span>
<a id="__codelineno-66-19" name="__codelineno-66-19" href="#__codelineno-66-19"></a><span class="w">    </span><span class="nt">remoteRef</span><span class="p">:</span>
<a id="__codelineno-66-20" name="__codelineno-66-20" href="#__codelineno-66-20"></a><span class="w">      </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span><span class="w">                                      </span><span class="c1"># Vault secret path (kv/test)</span>
<a id="__codelineno-66-21" name="__codelineno-66-21" href="#__codelineno-66-21"></a><span class="w">      </span><span class="nt">property</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vault-username</span><span class="w">                                </span><span class="c1"># Vault secret field name</span>
</code></pre></div>
<p>Apply the ExternalSecret:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>externalsecret.yaml
</code></pre></div>
<h4 id="step-11-verify-integration">Step 11: Verify Integration</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="c1"># Check ExternalSecret status</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a>kubectl<span class="w"> </span>get<span class="w"> </span>externalsecret<span class="w"> </span>vault-example<span class="w"> </span>-n<span class="w"> </span>eso
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="c1"># View ExternalSecret details</span>
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a>kubectl<span class="w"> </span>describe<span class="w"> </span>externalsecret<span class="w"> </span>vault-example<span class="w"> </span>-n<span class="w"> </span>eso
<a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a>
<a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a><span class="c1"># Verify Kubernetes secret creation</span>
<a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>devops-test<span class="w"> </span>-n<span class="w"> </span>eso<span class="w"> </span>-o<span class="w"> </span>yaml
<a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a>
<a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a><span class="c1"># Decode and view secret content</span>
<a id="__codelineno-68-11" name="__codelineno-68-11" href="#__codelineno-68-11"></a>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>devops-test<span class="w"> </span>-n<span class="w"> </span>eso<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.k8s-username}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d
<a id="__codelineno-68-12" name="__codelineno-68-12" href="#__codelineno-68-12"></a><span class="c1"># Expected output: test-username-123</span>
<a id="__codelineno-68-13" name="__codelineno-68-13" href="#__codelineno-68-13"></a>
<a id="__codelineno-68-14" name="__codelineno-68-14" href="#__codelineno-68-14"></a><span class="c1"># Check ESO controller logs for troubleshooting</span>
<a id="__codelineno-68-15" name="__codelineno-68-15" href="#__codelineno-68-15"></a>kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>eso<span class="w"> </span>-l<span class="w"> </span>app.kubernetes.io/name<span class="o">=</span>external-secrets<span class="w"> </span>--tail<span class="o">=</span><span class="m">50</span>
</code></pre></div>
<h3 id="troubleshooting">Troubleshooting</h3>
<p>If you encounter issues:</p>
<ol>
<li><strong>Check ClusterSecretStore status</strong>: Must show "Valid"</li>
<li><strong>Verify Vault connectivity</strong>: Ensure Vault server is accessible from Kubernetes</li>
<li><strong>Check ESO logs</strong>: Look for authentication or permission errors</li>
<li><strong>Validate token</strong>: Ensure service account token is not expired</li>
<li><strong>Test Vault authentication manually</strong>: Use <code>vault write auth/kubernetes/login</code> command</li>
</ol>
<p>Common issues:
- Token expiration (recreate token secret)
- Network connectivity between Kubernetes and Vault
- Incorrect Vault policy permissions
- Wrong service account or namespace bindings</p>
<h2 id="database-secret-engine">database secret engine</h2>
<h3 id="running-postgres-pod">running postgres pod</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>--namespace<span class="w"> </span>default<span class="w"> </span>postgre-vault-test-postgresql<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.data.postgres-password}&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>MQEvdzuWw6
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>
<a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>postgre-vault-test-postgresql-0<span class="w"> </span>--<span class="w"> </span>bash
<a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a>
<a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a>
<a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a>psql<span class="w"> </span>-U<span class="w"> </span>vault<span class="w"> </span>-d<span class="w"> </span>postgres
<a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a>pass:<span class="w"> </span>vault
<a id="__codelineno-69-9" name="__codelineno-69-9" href="#__codelineno-69-9"></a>
<a id="__codelineno-69-10" name="__codelineno-69-10" href="#__codelineno-69-10"></a>CREATE<span class="w"> </span>ROLE<span class="w"> </span>vault<span class="w"> </span>WITH<span class="w"> </span>LOGIN<span class="w"> </span>SUPERUSER<span class="w"> </span>PASSWORD<span class="w"> </span><span class="s1">&#39;vault&#39;</span><span class="p">;</span>
</code></pre></div>
<h3 id="enable-secret-engine">enable secret engine</h3>
<p>vault secrets enable database</p>
<p>vault write database/config/postgres plugin_name=postgresql-database-plugin allowed_roles="sql-role" connection_url="postgresql://{{username}}:{{password}}@postgre-vault-test-postgresql.default.svc:5432/postgres?sslmode=disable" username="vault" password="vault"</p>
<p>vault write database/roles/sql-role db_name=postgres creation_statements="CREATE ROLE \"{{name}}\" WITH LOGIN PASSWORD '{{password}}' VALID UNTIL '{{expiration}}'; GRANT SELECT ON ALL TABLES IN SCHEMA public TO \"{{name}}\";" default_ttl="1h" max_ttl="24h"</p>
<p>vault read database/creds/sql-role</p>
<h3 id="define-policy-for-database-role">define policy for database role</h3>
<p>kubectl -n vault-example exec -it vault-example-0 sh</p>
<p>cat &lt;<EOF > /home/vault/postgres-app-policy.hcl
path "database/creds/sql-role" {
  capabilities = ["read"]
}
EOF</p>
<p>vault policy write postgres-app-policy /home/vault/postgres-app-policy.hcl</p>
<h2 id="regenerate-new-root-token">regenerate new root-token</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>vault<span class="w"> </span>operator<span class="w"> </span>generate-root<span class="w"> </span>-init
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="c1"># show the output and use nonce and OTP with code</span>
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a>A<span class="w"> </span>One-Time-Password<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>generated<span class="w"> </span><span class="k">for</span><span class="w"> </span>you<span class="w"> </span>and<span class="w"> </span>is<span class="w"> </span>shown<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>OTP<span class="w"> </span>field.
<a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a>You<span class="w"> </span>will<span class="w"> </span>need<span class="w"> </span>this<span class="w"> </span>value<span class="w"> </span>to<span class="w"> </span>decode<span class="w"> </span>the<span class="w"> </span>resulting<span class="w"> </span>root<span class="w"> </span>token,<span class="w"> </span>so<span class="w"> </span>keep<span class="w"> </span>it<span class="w"> </span>safe.
<a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a>Nonce<span class="w">         </span>ed835311-96a5-b34b-b0b5-dab778cad815
<a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a>Started<span class="w">       </span><span class="nb">true</span>
<a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a>Progress<span class="w">      </span><span class="m">0</span>/3
<a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a>Complete<span class="w">      </span><span class="nb">false</span>
<a id="__codelineno-70-10" name="__codelineno-70-10" href="#__codelineno-70-10"></a>OTP<span class="w">           </span>HH8Yi0nYyKmIHV9c2J2v9LH7qFG4
<a id="__codelineno-70-11" name="__codelineno-70-11" href="#__codelineno-70-11"></a>OTP<span class="w"> </span>Length<span class="w">    </span><span class="m">28</span>
<a id="__codelineno-70-12" name="__codelineno-70-12" href="#__codelineno-70-12"></a>
<a id="__codelineno-70-13" name="__codelineno-70-13" href="#__codelineno-70-13"></a>vault<span class="w"> </span>operator<span class="w"> </span>generate-root<span class="w"> </span>-nonce<span class="o">=</span>&lt;nonce-number&gt;
<a id="__codelineno-70-14" name="__codelineno-70-14" href="#__codelineno-70-14"></a><span class="k">then</span><span class="w"> </span>enter<span class="w"> </span>unseal-1
<a id="__codelineno-70-15" name="__codelineno-70-15" href="#__codelineno-70-15"></a>vault<span class="w"> </span>operator<span class="w"> </span>generate-root<span class="w"> </span>-nonce<span class="o">=</span>&lt;nonce-number&gt;
<a id="__codelineno-70-16" name="__codelineno-70-16" href="#__codelineno-70-16"></a><span class="k">then</span><span class="w"> </span>enter<span class="w"> </span>unseal-2
<a id="__codelineno-70-17" name="__codelineno-70-17" href="#__codelineno-70-17"></a>...
<a id="__codelineno-70-18" name="__codelineno-70-18" href="#__codelineno-70-18"></a>last<span class="w"> </span>output<span class="w"> </span>get<span class="w"> </span>&lt;Encoded-Token&gt;
<a id="__codelineno-70-19" name="__codelineno-70-19" href="#__codelineno-70-19"></a>
<a id="__codelineno-70-20" name="__codelineno-70-20" href="#__codelineno-70-20"></a>
<a id="__codelineno-70-21" name="__codelineno-70-21" href="#__codelineno-70-21"></a>vault<span class="w"> </span>operator<span class="w"> </span>generate-root<span class="w"> </span>-decode<span class="o">=</span>&lt;Encoded-Token&gt;<span class="w"> </span>-otp<span class="o">=</span>&lt;OTP-Token&gt;
<a id="__codelineno-70-22" name="__codelineno-70-22" href="#__codelineno-70-22"></a>
<a id="__codelineno-70-23" name="__codelineno-70-23" href="#__codelineno-70-23"></a>
<a id="__codelineno-70-24" name="__codelineno-70-24" href="#__codelineno-70-24"></a>get<span class="w"> </span>new<span class="w"> </span>root-token
<a id="__codelineno-70-25" name="__codelineno-70-25" href="#__codelineno-70-25"></a>
<a id="__codelineno-70-26" name="__codelineno-70-26" href="#__codelineno-70-26"></a><span class="s2">&quot;hvs.xxx&quot;</span>
<a id="__codelineno-70-27" name="__codelineno-70-27" href="#__codelineno-70-27"></a>
<a id="__codelineno-70-28" name="__codelineno-70-28" href="#__codelineno-70-28"></a>
<a id="__codelineno-70-29" name="__codelineno-70-29" href="#__codelineno-70-29"></a>Not:<span class="w"> </span>not<span class="w"> </span>revoke<span class="w"> </span>first<span class="w"> </span>root<span class="w"> </span>token.<span class="w"> </span>use<span class="w"> </span>both
<a id="__codelineno-70-30" name="__codelineno-70-30" href="#__codelineno-70-30"></a>
<a id="__codelineno-70-31" name="__codelineno-70-31" href="#__codelineno-70-31"></a><span class="k">if</span><span class="w"> </span>you<span class="w"> </span>want<span class="w"> </span>to<span class="w"> </span>revoke<span class="w"> </span>other<span class="w"> </span>root<span class="w"> </span>token<span class="w"> </span>
<a id="__codelineno-70-32" name="__codelineno-70-32" href="#__codelineno-70-32"></a>
<a id="__codelineno-70-33" name="__codelineno-70-33" href="#__codelineno-70-33"></a>vault<span class="w"> </span>token<span class="w"> </span>revoke<span class="w"> </span>&lt;old-root-token&gt;
</code></pre></div>
<h2 id="vault-policy-group-and-user-configuration">Vault Policy, Group, and User Configuration</h2>
<p>This document outlines the steps for creating policies, groups, and users in Vault, including how to assign policies to groups and users to groups, using both Vault CLI and Vault UI.</p>
<p>Vault Policy Creation
In Vault, policies are created to manage appropriate paths within secret engines. These policies define access permissions for specific paths. The following examples demonstrate how to create policies for different projects and environments using the kv secret engine.</p>
<p>Example Policy Structure
Policies can be created individually for each project and environment combination, or with a more general approach. Here, it's assumed you have different secret engines like parasut, zirve, mikro. If these are not separate secret engines but rather paths under the kv secret engine, they should be structured as path "secret/data/parasut/...".</p>
<ul>
<li>mikro-all-policy.hcl (Example: A more general policy for Mikro)</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>path<span class="w"> </span><span class="s2">&quot;auth/ldap/login/*&quot;</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="w">  </span><span class="nv">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;read&quot;</span>,<span class="w"> </span><span class="s2">&quot;update&quot;</span><span class="o">]</span>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="o">}</span>
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a>path<span class="w"> </span><span class="s2">&quot;zirve/metadata/*&quot;</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="w">  </span><span class="nv">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;read&quot;</span>,<span class="w"> </span><span class="s2">&quot;list&quot;</span><span class="o">]</span>
<a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="o">}</span>
<a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a>path<span class="w"> </span><span class="s2">&quot;zirve/data/&lt;project-name&gt;/*&quot;</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="w">  </span><span class="nv">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;read&quot;</span>,<span class="w"> </span><span class="s2">&quot;update&quot;</span>,<span class="w"> </span><span class="s2">&quot;delete&quot;</span>,<span class="w"> </span><span class="s2">&quot;list&quot;</span><span class="o">]</span>
<a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a><span class="o">}</span>
</code></pre></div>
<h3 id="methods-to-create-policies">Methods to Create Policies</h3>
<p>Vault policies can be created using a few different methods:</p>
<ol>
<li>Via HCL Files and Vault CLI (Recommended for Version Control)
This method involves defining policies in .hcl files and then uploading them to Vault using the CLI. This is generally recommended for version control and automation.</li>
</ol>
<p>After creating each .hcl file, you can upload these policies to Vault using the Vault CLI:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="c1"># Upload project policy</span>
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a>vault<span class="w"> </span>policy<span class="w"> </span>write<span class="w"> </span>&lt;project-policy-name&gt;<span class="w"> </span>mikro-all-policy.hcl
</code></pre></div>
<ol>
<li>Via Vault UI
For users who prefer a graphical interface, policies can also be created and managed directly through the Vault UI.</li>
</ol>
<p>Access your Vault UI (http://your-vault-server.example.com/).</p>
<p>Navigate to Policies in the left-hand menu.</p>
<ul>
<li>Click on Create new policy.</li>
</ul>
<p>Provide a Policy Name and paste the HCL policy definition into the Policy HCL text area.
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>path<span class="w"> </span><span class="s2">&quot;auth/ldap/login/*&quot;</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="w">  </span><span class="nv">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;read&quot;</span>,<span class="w"> </span><span class="s2">&quot;update&quot;</span><span class="o">]</span>
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="o">}</span>
<a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a>path<span class="w"> </span><span class="s2">&quot;zirve/metadata/*&quot;</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="w">  </span><span class="nv">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;read&quot;</span>,<span class="w"> </span><span class="s2">&quot;list&quot;</span><span class="o">]</span>
<a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a><span class="o">}</span>
<a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a>path<span class="w"> </span><span class="s2">&quot;zirve/data/&lt;project-name&gt;/*&quot;</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a><span class="w">  </span><span class="nv">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;read&quot;</span>,<span class="w"> </span><span class="s2">&quot;update&quot;</span>,<span class="w"> </span><span class="s2">&quot;delete&quot;</span>,<span class="w"> </span><span class="s2">&quot;list&quot;</span><span class="o">]</span>
<a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a><span class="o">}</span>
</code></pre></div>
- Click Create policy.</p>
<h3 id="group-creation-and-policy-assignment">Group Creation and Policy Assignment</h3>
<p>Vault groups are used to manage collections of entities (users or machines) and assign policies to them. This simplifies permission management by allowing policies to be assigned to groups rather than individual entities.</p>
<ul>
<li>
<p>Methods for Group Creation and Policy Assignment</p>
</li>
<li>
<p>Via Vault CLI
First, ensure the identity secrets engine is enabled (it usually is by default). Then, create groups and assign policies to them.</p>
</li>
</ul>
<h2 id="create-project-team-group-and-assign-policy">Create project-team group and assign policy</h2>
<p>vault write auth/ldap/groups/<groupname> policies=<group-policy></p>
<ol>
<li>Via Vault UI
Groups can also be created and managed through the Vault UI.</li>
</ol>
<p>Access your Vault UI.</p>
<p>Navigate to Access &gt; LDAP in the left-hand menu.</p>
<p>Go to the Groups tab.</p>
<ul>
<li>Click Create Group.</li>
</ul>
<p>Enter the Group Name (e.g., shopside-policy).</p>
<p>Select the Policies to attach to this group.</p>
<ul>
<li>Click Save Group.</li>
</ul>
<h3 id="user-creation-and-group-assignment">User Creation and Group Assignment</h3>
<p>Users (referred to as "entities" in Vault's Identity system) can be created and then associated with authentication methods. These entities can then be assigned to groups to inherit policies. Here, we'll use the userpass auth method for demonstration.</p>
<ul>
<li>
<p>Methods for User Creation and Group Assignment</p>
</li>
<li>
<p>Via Vault CLI
First, create a user with LDAP auth method. Then, create an identity entity for this user and link it to the group.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="c1"># Create a user in the userpass auth method</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>vault<span class="w"> </span>write<span class="w"> </span>auth/ldap/users/&lt;LDAP-Username&gt;<span class="w"> </span><span class="nv">groups</span><span class="o">=</span>&lt;groupname&gt;
</code></pre></div>
<ol>
<li>Via Vault UI
You can create users and assign them to groups directly via the Vault UI.</li>
</ol>
<p>Access your Vault UI.</p>
<p>Create User (via Auth Method):</p>
<p>Navigate to Access &gt; LDAP in the left-hand menu.</p>
<p>Go to the Users tab.</p>
<ul>
<li>Click Create User.</li>
</ul>
<p>Enter a Username (e.g., name.lastname)</p>
<p>Enter the Group Name (e.g., shopside-policy).</p>
<p>If need enter special Policies to attach to this user</p>
<ul>
<li>Click Save User</li>
</ul>
<h3 id="vault-secret-creation-and-referencing-in-deployments">Vault Secret Creation and Referencing in Deployments</h3>
<p>This document describes how to create secrets within the Vault UI and how to reference these secrets in your application's deployment configuration, specifically within a values.yaml file for Kubernetes.</p>
<ul>
<li>Creating Secrets via Vault UI
A user with appropriate policy permissions can create secrets within the relevant secret engine paths. These secrets can be entered as key-value pairs or as a JSON object, containing environment variables or other sensitive application data.</li>
</ul>
<p>Access your Vault UI.</p>
<p>Navigate to the Secrets section in the left-hand menu.</p>
<ul>
<li>Click on the specific secret engine you want to use (e.g., parasut/, zirve/).</li>
</ul>
<p>Browse or create the desired path (e.g., parasut/project1/dev).</p>
<ul>
<li>Click Create secret.</li>
</ul>
<p>Enter the Key and Value pairs directly, or toggle to JSON format to paste a JSON object containing multiple key-value pairs.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>Example<span class="w"> </span><span class="o">(</span>Key-Value<span class="o">)</span>:
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a>Key:<span class="w"> </span>DATABASE_URL
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>
<a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a>Value:<span class="w"> </span>jdbc:postgresql://db.example.com:5432/mydb
<a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a>
<a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a>Example<span class="w"> </span><span class="o">(</span>JSON<span class="o">)</span>:
<a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a>
<a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a><span class="o">{</span>
<a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a><span class="w">  </span><span class="s2">&quot;API_KEY&quot;</span>:<span class="w"> </span><span class="s2">&quot;your_api_key_here&quot;</span>,
<a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a><span class="w">  </span><span class="s2">&quot;SERVICE_ACCOUNT_EMAIL&quot;</span>:<span class="w"> </span><span class="s2">&quot;service@example.com&quot;</span>
<a id="__codelineno-75-12" name="__codelineno-75-12" href="#__codelineno-75-12"></a><span class="o">}</span>
</code></pre></div>
<ul>
<li>Click Save.</li>
</ul>
<h4 id="referencing-secrets-in-deployment-configuration-valuesyaml">Referencing Secrets in Deployment Configuration (values.yaml)</h4>
<p>After creating the secret in Vault, you can reference it in your application's deployment repository, typically within the dev-test-staging directories' values.yaml files. This is done using the externalSecretVault configuration, which leverages an External Secrets Operator (ESO) in Kubernetes to fetch secrets from Vault.</p>
<p>Locate the values.yaml file for your specific deployment environment (e.g., deployments/dev/values.yaml) and add the following section:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="nt">externalSecretVault</span><span class="p">:</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">projectname-clustername-external-secret</span><span class="w"> </span><span class="c1"># Unique name for the ExternalSecret resource</span>
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="w">  </span><span class="nt">secretStoreRef</span><span class="p">:</span>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vault-nonprod-xxx</span><span class="w"> </span><span class="c1"># Reference to your ClusterSecretStore or SecretStore</span>
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="w">  </span><span class="nt">dataFrom</span><span class="p">:</span>
<a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secretengine/projead/deployment-environment</span><span class="w"> </span><span class="c1"># Path to your secret in Vault (e.g., kv/parasut/project1/dev)</span>
<a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a>
<a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a><span class="c1">##----------UYARI---------##</span>
<a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a><span class="c1"># Bu blmdeki extraSecret ve extraConfigMap blmleri artk kullanlmamaktadr.</span>
<a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a><span class="c1"># Bunun yerine externalSecretVault kullanlmaktadr.</span>
<a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a><span class="c1"># Ekleme yapmak iin Devops ekibi ile iletiime geiniz.</span>
<a id="__codelineno-76-12" name="__codelineno-76-12" href="#__codelineno-76-12"></a><span class="c1">##-----------UYARI--------##</span>
</code></pre></div>
<h3 id="creating-a-clustersecretstore-for-a-new-secret-engine">Creating a ClusterSecretStore for a New Secret Engine</h3>
<p>If you are creating a new secret engine in Vault and need to integrate it with Kubernetes via External Secrets Operator (ESO), you will need to create a corresponding <code>ClusterSecretStore</code> resource in your Kubernetes cluster. There are generally two methods to achieve this:</p>
<h3 id="method-1-cloning-an-existing-clustersecretstore">Method 1: Cloning an Existing ClusterSecretStore</h3>
<p>You can clone an existing <code>ClusterSecretStore</code> definition via the Rancher UI and modify its <code>name</code> and <code>path</code> fields to match your new secret engine. This is often the quickest way if you have a template and prefer a graphical interface.</p>
<ol>
<li>Navigate to the relevant cluster in the Rancher interface.</li>
<li>In the left-hand sidebar, go to <strong>More Resources</strong> --&gt; <strong>external-secrets.io</strong> and then enter the <strong>ClusterSecretStore</strong> section.</li>
<li>On the right side of the <code>ClusterSecretStore</code> you wish to clone, click on the <code>...</code> (three dots) icon and select <strong>Clone</strong>.</li>
<li>In the pop-up window, change the <code>name</code> and <code>path</code> fields to create the new one.</li>
</ol>
<h3 id="method-2-applying-a-new-clustersecretstore-crd">Method 2: Applying a New ClusterSecretStore CRD</h3>
<p>You can directly apply a new <code>ClusterSecretStore</code> Custom Resource Definition (CRD) to your Kubernetes cluster. This method gives you full control over the definition.</p>
<p>Create a YAML file (e.g., <code>vault-new-secretstore.yaml</code>) with the following content and apply it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-secrets.io/v1beta1</span>
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterSecretStore</span>
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vault-nonprod-xxx</span>
<a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a><span class="w">  </span><span class="nt">provider</span><span class="p">:</span>
<a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a><span class="w">    </span><span class="nt">vault</span><span class="p">:</span>
<a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a><span class="w">      </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://your-vault-server.example.com/&quot;</span>
<a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&lt;parasut&gt;&quot;</span><span class="w">   </span><span class="c1"># CHANGE ME. Path to the secrets in Vault</span>
<a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a><span class="w">      </span><span class="c1"># Version is the Vault KV secret engine version.</span>
<a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a><span class="w">      </span><span class="c1"># This can be either &quot;v1&quot; or &quot;v2&quot;, defaults to &quot;v2&quot;</span>
<a id="__codelineno-77-12" name="__codelineno-77-12" href="#__codelineno-77-12"></a><span class="w">      </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;v2&quot;</span>
<a id="__codelineno-77-13" name="__codelineno-77-13" href="#__codelineno-77-13"></a><span class="w">      </span><span class="nt">auth</span><span class="p">:</span>
<a id="__codelineno-77-14" name="__codelineno-77-14" href="#__codelineno-77-14"></a><span class="w">        </span><span class="nt">tokenSecretRef</span><span class="p">:</span>
<a id="__codelineno-77-15" name="__codelineno-77-15" href="#__codelineno-77-15"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;vault-nonprod-token&quot;</span><span class="w"> </span><span class="c1"># Name of the Kubernetes secret containing the Vault token</span>
<a id="__codelineno-77-16" name="__codelineno-77-16" href="#__codelineno-77-16"></a><span class="w">          </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;token&quot;</span><span class="w">   </span><span class="c1"># Key in the Kubernetes secret that contains the Vault token</span>
<a id="__codelineno-77-17" name="__codelineno-77-17" href="#__codelineno-77-17"></a><span class="w">          </span><span class="nt">namespace</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">eso</span><span class="w"> </span><span class="c1"># Namespace where the secret is located</span>
<a id="__codelineno-77-18" name="__codelineno-77-18" href="#__codelineno-77-18"></a>
<a id="__codelineno-77-19" name="__codelineno-77-19" href="#__codelineno-77-19"></a>
<a id="__codelineno-77-20" name="__codelineno-77-20" href="#__codelineno-77-20"></a><span class="c1"># Apply the CRD to your cluster:</span>
<a id="__codelineno-77-21" name="__codelineno-77-21" href="#__codelineno-77-21"></a><span class="l l-Scalar l-Scalar-Plain">kubectl apply -f vault-new-secretstore.yaml</span>
<a id="__codelineno-77-22" name="__codelineno-77-22" href="#__codelineno-77-22"></a>
<a id="__codelineno-77-23" name="__codelineno-77-23" href="#__codelineno-77-23"></a><span class="c1"># After applying, verify the status of your new ClusterSecretStore:</span>
<a id="__codelineno-77-24" name="__codelineno-77-24" href="#__codelineno-77-24"></a>
<a id="__codelineno-77-25" name="__codelineno-77-25" href="#__codelineno-77-25"></a><span class="l l-Scalar l-Scalar-Plain">kubectl get ClusterSecretStore &lt;your-new-store-name&gt;</span>
<a id="__codelineno-77-26" name="__codelineno-77-26" href="#__codelineno-77-26"></a>
<a id="__codelineno-77-27" name="__codelineno-77-27" href="#__codelineno-77-27"></a><span class="c1"># Ensure the status indicates it&#39;s Valid.</span>
</code></pre></div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://linkedin.com/company/hepapi" target="_blank" rel="noopener" title="Linkedin" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://github.com/hepapi" target="_blank" rel="noopener" title="Github" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.tracking", "navigation.instant", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.tabs.link", "content.action.edit", "navigation.instant.prefetch", "navigation.instant.progress"], "search": "../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>